(function(){Cocoon=window.Cocoon?window.Cocoon:{};Cocoon.version="3.0.5";Cocoon.nativeAvailable=!!window.ext;Cocoon.extend=function(a,e){var b=a.prototype,c=function(){};c.prototype=e.prototype;a.prototype=new c;a.superclass=e.prototype;a.prototype.constructor=a;e.prototype.constructor===Object.prototype.constructor&&(e.prototype.constructor=e);for(var d in b)b.hasOwnProperty(d)&&(a.prototype[d]=b[d])};Cocoon.clone=function(a,e){if(null==a||"object"!=typeof a)return a;var b=[],c;for(c in a)e.hasOwnProperty(c)?
b.push(e[c]):b.push(a[c]);return b};Cocoon.callNative=function(a,e,b,c){if(Cocoon.nativeAvailable){b=Array.prototype.slice.call(b);b.unshift(e);a=ext[a];a=c=(c?a.makeCallAsync:a.makeCall).apply(a,b);if("string"===typeof c)try{a=JSON.parse(c)}catch(d){console.log(d)}return a}};Cocoon.getObjectFromPath=function(a,e){for(var b=e.split("."),c=a,d=0,f=b.length;d<f;++d)c[b[d]]=c[b[d]]||void 0,c=c[b[d]];return c};Cocoon.EventHandler=function(a,e,b,c){this.listeners=[];this.listenersOnce=[];this.chainFunction=
c;this.addEventListener=function(d){if(c){var f=function(){c.call(this,arguments.callee.sourceListener,Array.prototype.slice.call(arguments))};d.CocoonEventHandlerChainFunction=f;f.sourceListener=d;d=f}(f=Cocoon.getObjectFromPath(Cocoon,e))&&f.nativeAvailable?ext[a].addEventListener(b,d):0>this.listeners.indexOf(d)&&this.listeners.push(d)};this.addEventListenerOnce=function(d){if(c){var f=function(){c(arguments.callee.sourceListener,Array.prototype.slice.call(arguments))};f.sourceListener=d;d=f}Cocoon.getObjectFromPath(Cocoon,
e).nativeAvailable?ext[a].addEventListenerOnce(b,d):0>this.listeners.indexOf(d)&&this.listenersOnce.push(d)};this.removeEventListener=function(d){c&&(d=d.CocoonEventHandlerChainFunction,delete d.CocoonEventHandlerChainFunction);Cocoon.getObjectFromPath(Cocoon,e).nativeAvailable?ext[a].removeEventListener(b,d):(d=this.listeners.indexOf(d),0<=d&&this.listeners.splice(d,1))};this.removeEventListenerOnce=function(d){c&&(d=d.CocoonEventHandlerChainFunction,delete d.CocoonEventHandlerChainFunction);Cocoon.getObjectFromPath(Cocoon,
e).nativeAvailable?ext[a].removeEventListenerOnce(b,d):(d=this.listenersOnce.indexOf(d),0<=d&&this.listenersOnce.splice(d,1))};this.notifyEventListeners=function(){var d=Cocoon.getObjectFromPath(Cocoon,e);if(d&&d.nativeAvailable)ext[a].notifyEventListeners(b);else{var c=Array.prototype.slice.call(arguments),h=Array.prototype.slice.call(this.listeners),k=Array.prototype.slice.call(this.listenersOnce),g=this;setTimeout(function(){for(var b=0;b<h.length;b++)h[b].apply(g,c);for(b=0;b<k.length;b++)k[b].apply(g,
c)},0);g.listenersOnce=[]}};return this};Cocoon.define=function(a,e){for(var b="Cocoon."==a.substring(0,7)?a.substr(7):a,c=window.Cocoon,b=b.split("."),d=0;d<b.length;d++){var f=b[d];c[f]?console.log("Updated namespace: - "+a):console.log("Created namespace: "+a);c=c[f]=d==b.length-1?e(c[f]||{}):{};if(!c)throw"Unable to create class "+a;}return!0};console.log("Created namespace: Cocoon")})();
Cocoon.define("Cocoon.Signal",function(a){a.createSignal=function(){this.handle=null;this.signals={};this.register=function(a,b){if(!a&&!b)throw Error("Can't create signal "+(a||""));if(b.addEventListener)return this.signals[a]=b,!0;if(!b.addEventListener){this.signals[a]={};for(var c in b)b.hasOwnProperty(c)&&(this.signals[a][c]=b[c]);return!0}throw Error("Can't create handler for "+a+" signal.");};this.expose=function(){return function(a,b,c){var d=!1;if(1===arguments.length){var f=this,d=function(b){this.signal=
b};d.prototype.remove=function(b){var a=f.signals[this.signal];a&&a.removeEventListener&&(a.removeEventListener.apply(f,[b]),f.signals[this.signal]=void 0)};return new d(a)}c&&c.once&&(d=!0);if(!this.signals[a])throw Error("The signal "+a+" does not exists.");var h=this.signals[a];h.addEventListener&&(d?h.addEventListenerOnce(function(){b.apply(this||window,arguments)}):h.addEventListener(function(){b.apply(this||window,arguments)}));if(!this.signals[a].addEventListener)for(var k in this.signals[a])this.signals[a].hasOwnProperty(k)&&
(h=this.signals[a][k],d?h.addEventListenerOnce(function(){this.clbk[this.name].apply(this||window,arguments)}.bind({name:k,clbk:b})):h.addEventListener(function(){this.clbk[this.name].apply(this||window,arguments)}.bind({name:k,clbk:b})))}.bind(this)}};return a});
Cocoon.define("Cocoon.App",function(a){a.nativeAvailable=!!window.ext&&!!window.ext.IDTK_APP;a.isBridgeAvailable=function(){if("boolean"===Cocoon.App.forward.nativeAvailable)return Cocoon.App.forward.nativeAvailable;var b=Cocoon.callNative("IDTK_APP","forwardAvailable",arguments),b=!!b;return Cocoon.App.forward.nativeAvailable=b};a.forward=function(b){if(Cocoon.App.nativeAvailable&&Cocoon.App.isBridgeAvailable())return Cocoon.callNative("IDTK_APP","forward",arguments);if(!navigator.isCocoonJS)return"CocoonJS_App_ForCocoonJS_WebViewIFrame"==
window.name?window.parent.eval(b):window.frames.CocoonJS_App_ForCocoonJS_WebViewIFrame.window.eval(b)};a.forwardAsync=function(b,a){if(Cocoon.App.nativeAvailable&&Cocoon.App.isBridgeAvailable())return"undefined"!==typeof a?ext.IDTK_APP.makeCallAsync("forward",b,a):ext.IDTK_APP.makeCallAsync("forward",b);setTimeout(function(){var e;"CocoonJS_App_ForCocoonJS_WebViewIFrame"==window.name?(e=window.parent.eval(b),"function"===typeof a&&a(e)):(e=window.parent.frames.CocoonJS_App_ForCocoonJS_WebViewIFrame.window.eval(b),
"function"===typeof a&&a(e))},1)};a.load=function(b,a){if(Cocoon.App.nativeAvailable)return Cocoon.callNative("IDTK_APP","loadPath",arguments);if(!navigator.isCocoonJS){var e=new XMLHttpRequest;e.onreadystatechange=function(a){4===e.readyState&&(200===e.status?(a=Cocoon.App.EmulatedWebViewIFrame?"window.Cocoon && window.Cocoon.App.onLoadInCocoonJSSucceed.notifyEventListeners('"+b+"');":"window.Cocoon && window.Cocoon.App.onLoadInTheWebViewSucceed.notifyEventListeners('"+b+"');",Cocoon.App.forwardAsync(a),
window.location.href=b):404===e.status&&(this.onreadystatechange=null,a=Cocoon.App.EmulatedWebViewIFrame?"Cocoon && Cocoon.App.onLoadInCocoonJSFailed.notifyEventListeners('"+b+"');":"Cocoon && Cocoon.App.onLoadInTheWebViewFailed.notifyEventListeners('"+b+"');",Cocoon.App.forwardAsync(a)))};e.open("GET",b,!0);e.send()}};a.reload=function(){if(Cocoon.App.nativeAvailable)return Cocoon.callNative("IDTK_APP","reload",arguments);if(!navigator.isCocoonJS)return"CocoonJS_App_ForCocoonJS_WebViewIFrame"==window.name?
window.parent.location.reload():window.parent.frames.CocoonJS_App_ForCocoonJS_WebViewIFrame.window.location.reload()};a.openURL=function(b){if(Cocoon.App.nativeAvailable)return Cocoon.callNative("IDTK_APP","openURL",arguments,!0);navigator.isCocoonJS||window.open(b,"_blank")};a.exit=function(){if(Cocoon.App.nativeAvailable)return Cocoon.callNative("IDTK_APP","forceToFinish",arguments);navigator.isCocoonJS||window.close()};a.StorageType={APP_STORAGE:"APP_STORAGE",INTERNAL_STORAGE:"INTERNAL_STORAGE",
EXTERNAL_STORAGE:"EXTERNAL_STORAGE",TEMPORARY_STORAGE:"TEMPORARY_STORAGE"};a.onSuspended=new Cocoon.EventHandler("IDTK_APP","App","onsuspended");a.onActivated=new Cocoon.EventHandler("IDTK_APP","App","onactivated");a.onSuspending=new Cocoon.EventHandler("IDTK_APP","App","onsuspending");a.onMemoryWarning=new Cocoon.EventHandler("IDTK_APP","App","onmemorywarning");var e=new Cocoon.Signal.createSignal;e.register("suspended",a.onSuspended);e.register("activated",a.onActivated);e.register("suspending",
a.onSuspending);e.register("memorywarning",a.onMemoryWarning);a.on=e.expose();return a});
Cocoon.define("Cocoon.App",function(a){function e(){var b=Cocoon.App.EmulatedWebView;if(!b){b=document.createElement("div");b.setAttribute("id","CocoonJS_App_ForCocoonJS_WebViewDiv");b.style.width=0;b.style.height=0;b.style.position="absolute";b.style.left=0;b.style.top=0;b.style.backgroundColor="transparent";b.style.border="0px solid #000";var a=document.createElement("IFRAME");a.setAttribute("id","CocoonJS_App_ForCocoonJS_WebViewIFrame");a.setAttribute("name","CocoonJS_App_ForCocoonJS_WebViewIFrame");
a.style.width=0;a.style.height=0;a.frameBorder=0;a.allowtransparency=!0;b.appendChild(a);Cocoon.App.EmulatedWebView=b;Cocoon.App.EmulatedWebViewIFrame=a;document.body||(document.body=document.createElement("body"));document.body.appendChild(Cocoon.App.EmulatedWebView)}}a.pause=function(){if(Cocoon.App.nativeAvailable)return Cocoon.callNative("IDTK_APP","pause",arguments)};a.resume=function(){if(Cocoon.App.nativeAvailable)return Cocoon.callNative("IDTK_APP","resume",arguments)};a.loadInTheWebView=
function(b,a){if(navigator.isCocoonJS&&Cocoon.App.nativeAvailable)Cocoon.callNative("IDTK_APP","loadInTheWebView",arguments);else{var f=new XMLHttpRequest;f.onreadystatechange=function(a){if(4===f.readyState)if(200<=f.status&&299>=f.status||0===f.status){e();var d=function(a){Cocoon.App.onLoadInTheWebViewSucceed.notifyEventListeners(b);Cocoon.App.EmulatedWebViewIFrame.removeEventListener("load",d)};Cocoon.App.EmulatedWebViewIFrame.addEventListener("load",d);Cocoon.App.EmulatedWebViewIFrame.contentWindow.location.href=
b}else this.onreadystatechange=null,Cocoon.App.onLoadInTheWebViewFailed.notifyEventListeners(b)};f.open("GET",b,!0);f.send()}};a.reloadWebView=function(){Cocoon.App.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_APP","reloadWebView",arguments):(e(),Cocoon.App.EmulatedWebViewIFrame.contentWindow.location.reload())};a.showTheWebView=function(b,a,f,h){Cocoon.App.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_APP","showTheWebView",arguments):(e(),Cocoon.App.EmulatedWebViewIFrame.style.width=
(f?f/window.devicePixelRatio:window.innerWidth)+"px",Cocoon.App.EmulatedWebViewIFrame.style.height=(h?h/window.devicePixelRatio:window.innerHeight)+"px",Cocoon.App.EmulatedWebView.style.left=(b?b:0)+"px",Cocoon.App.EmulatedWebView.style.top=(a?a:0)+"px",Cocoon.App.EmulatedWebView.style.width=(f?f/window.devicePixelRatio:window.innerWidth)+"px",Cocoon.App.EmulatedWebView.style.height=(h?h/window.devicePixelRatio:window.innerHeight)+"px",Cocoon.App.EmulatedWebView.style.display="block")};a.hideTheWebView=
function(){if(Cocoon.App.nativeAvailable&&navigator.isCocoonJS)return Cocoon.App.forwardAsync("ext.IDTK_APP.makeCall('hide');");e();Cocoon.App.EmulatedWebView.style.display="none"};a.exitCallback=function(b){navigator.isCocoonJS&&Cocoon.App.nativeAvailable&&(window.onidtkappfinish=b)};a.forwardedEventFromTheWebView=function(b,a){var e=JSON.parse(a);e.target=window;var h=new Event(b),k;for(k in e)h[k]=e[k];h.target=window;window.dispatchEvent(h);e=document.getElementsByTagName("canvas");for(k=0;k<
e.length;k++)h.target=e[k],e[k].dispatchEvent(h)};a.onLoadInTheWebViewSucceed=new Cocoon.EventHandler("IDTK_APP","App","forwardpageload");a.onLoadInTheWebViewFailed=new Cocoon.EventHandler("IDTK_APP","App","forwardpagefail");var b=new Cocoon.Signal.createSignal;b.register("load",{success:a.onLoadInTheWebViewSucceed,error:a.onLoadInTheWebViewFailed});a.WebView=Cocoon.WebView||{};a.WebView.on=b.expose();return a});
Cocoon.define("Cocoon.Utils",function(a){a.logMemoryInfo=function(){if(Cocoon.nativeAvailable&&navigator.isCocoonJS)return Cocoon.callNative("IDTK_APP","logMemoryInfo",arguments)};a.textureReduction=function(a,b,c){if(Cocoon.nativeAvailable&&navigator.isCocoonJS)return Cocoon.callNative("IDTK_APP","setDefaultTextureReducerThreshold",arguments)};a.markAsMusic=function(a){if(Cocoon.nativeAvailable)return Cocoon.callNative("IDTK_APP","addForceMusic",arguments)};a.captureScreen=function(a,b,c,d){if(Cocoon.nativeAvailable)return Cocoon.callNative("IDTK_APP",
"captureScreen",arguments)};a.captureScreenAsync=function(a,b,c,d,f){Cocoon.nativeAvailable&&Cocoon.callNative("IDTK_APP","captureScreen",arguments,!0)};a.setAntialias=function(a){if(Cocoon.nativeAvailable&&navigator.isCocoonJS)return Cocoon.callNative("IDTK_APP","setDefaultAntialias",arguments)};a.setWebGLEnabled=function(a){if(Cocoon.nativeAvailable)return Cocoon.callNative("IDTK_APP","setDefaultAntialias",arguments)};a.setNPOTEnabled=function(a){if(Cocoon.nativeAvailable&&navigator.isCocoonJS)return window.ext.IDTK_APP.makeCall("setNPOTEnabled",
a)};a.setMaxMemory=function(a){if(Cocoon.nativeAvailable&&navigator.isCocoonJS)return window.ext.IDTK_APP.makeCall("setMaxMemory",a)};a.CaptureType={EVERYTHING:0,COCOONJS_GL_SURFACE:1,JUST_SYSTEM_VIEWS:2};a.existsPath=function(a,b){return Cocoon.nativeAvailable?Cocoon.callNative("IDTK_APP","existsPath",arguments):!1};a.setTextCacheSize=function(a){if(Cocoon.nativeAvailable&&navigator.isCocoonJS)return Cocoon.callNative("IDTK_APP","setTextCacheSize",arguments)};return a});
Cocoon.define("Cocoon.Dialog",function(a){a.keyboardType={TEXT:"text",NUMBER:"num",PHONE:"phone",EMAIL:"email",URL:"url"};a.prompt=function(a,b){if(!b)throw"Callback missing for Cocoon.Dialog.prompt();";var c=Cocoon.Dialog.keyboardType.TEXT;switch(a.type){case Cocoon.Dialog.keyboardType.TEXT:c=Cocoon.Dialog.keyboardType.TEXT;break;case Cocoon.Dialog.keyboardType.NUMBER:c=Cocoon.Dialog.keyboardType.NUMBER;break;case Cocoon.Dialog.keyboardType.PHONE:c=Cocoon.Dialog.keyboardType.PHONE;break;case Cocoon.Dialog.keyboardType.EMAIL:c=
Cocoon.Dialog.keyboardType.EMAIL;break;case Cocoon.Dialog.keyboardType.URL:c=Cocoon.Dialog.keyboardType.URL}var d={title:"",message:"",text:"",type:c,cancelText:"Cancel",confirmText:"Ok"},c=Cocoon.clone(d,a),f=function(){Cocoon.Dialog.onTextDialogCancelled.removeEventListener(h);Cocoon.Dialog.onTextDialogFinished.removeEventListener(f);b.success.apply(window,Array.prototype.slice.call(arguments))},h=function(){Cocoon.Dialog.onTextDialogCancelled.removeEventListener(h);Cocoon.Dialog.onTextDialogFinished.removeEventListener(f);
b.cancel.apply(window,Array.prototype.slice.call(arguments))};Cocoon.Dialog.onTextDialogCancelled.addEventListener(h);Cocoon.Dialog.onTextDialogFinished.addEventListener(f);if(Cocoon.App.nativeAvailable)return Cocoon.callNative("IDTK_APP","showTextDialog",c,!0);setTimeout(function(){var a=prompt(d.message,d.text);(a?Cocoon.Dialog.onTextDialogFinished:Cocoon.Dialog.onTextDialogCancelled).notifyEventListeners(a)},0)};a.confirm=function(a,b){if(!b)throw"Callback missing for Cocoon.Dialog.confirm();";
var c={title:"",message:"",cancelText:"Cancel",confirmText:"Ok"},d=Cocoon.clone(c,a),f=function(){Cocoon.Dialog.onMessageBoxDenied.removeEventListenerOnce(h);b(!0)},h=function(){Cocoon.Dialog.onMessageBoxConfirmed.removeEventListenerOnce(f);b(!1)};Cocoon.Dialog.onMessageBoxDenied.addEventListenerOnce(h);Cocoon.Dialog.onMessageBoxConfirmed.addEventListenerOnce(f);if(Cocoon.nativeAvailable)return Cocoon.callNative("IDTK_APP","showMessageBox",d,!0);setTimeout(function(){(confirm(c.message)?Cocoon.Dialog.onMessageBoxConfirmed:
Cocoon.Dialog.onMessageBoxDenied).notifyEventListeners()},0)};a.showKeyboard=function(a,b){a=a||{};a.type=a.type||Cocoon.Dialog.keyboardType.TEXT;var c=b&&b.insertText,d=b&&b.deleteBackward,f=b&&b.done,h=b&&b.cancel;Cocoon.nativeAvailable&&Cocoon.callNative("IDTK_APP","showKeyboard",[a,c,d,f,h],!0)};a.dismissKeyboard=function(){Cocoon.nativeAvailable&&Cocoon.callNative("IDTK_APP","dismissKeyboard",[],!0)};a.onTextDialogFinished=new Cocoon.EventHandler("IDTK_APP","App","ontextdialogfinish");a.onTextDialogCancelled=
new Cocoon.EventHandler("IDTK_APP","App","ontextdialogcancel");a.onMessageBoxConfirmed=new Cocoon.EventHandler("IDTK_APP","App","onmessageboxconfirmed");a.onMessageBoxDenied=new Cocoon.EventHandler("IDTK_APP","App","onmessageboxdenied");return a});
Cocoon.define("Cocoon.WebView",function(a){if("undefined"===typeof Cocoon||null===Cocoon||"undefined"===typeof Cocoon.App||null===Cocoon.App||navigator.isCocoonJS)return a;a.show=function(a,b,c,d){if(Cocoon.App.nativeAvailable)return Cocoon.callNative("IDTK_APP","show",arguments);var f=window.parent.document.getElementById("CocoonJS_App_ForCocoonJS_WebViewDiv");f.style.left=(a?a:f.style.left)+"px";f.style.top=(b?b:f.style.top)+"px";f.style.width=(c?c/window.devicePixelRatio:window.parent.innerWidth)+
"px";f.style.height=(d?d/window.devicePixelRatio:window.parent.innerHeight)+"px";f.style.display="block";f=window.parent.document.getElementById("CocoonJS_App_ForCocoonJS_WebViewIFrame");f.style.width=(c?c/window.devicePixelRatio:window.parent.innerWidth)+"px";f.style.height=(d?d/window.devicePixelRatio:window.parent.innerHeight)+"px"};a.hide=function(){if(Cocoon.App.nativeAvailable)return Cocoon.callNative("IDTK_APP","hide",arguments);window.parent.document.getElementById("CocoonJS_App_ForCocoonJS_WebViewDiv").style.display=
"none"};a.loadInCocoon=function(a,b,c){if(Cocoon.App.nativeAvailable)return b="ext.IDTK_APP.makeCall('loadPath'","undefined"!==typeof a&&(b+=", '"+a+"'","undefined"!==typeof c&&(b+=", '"+c+"'")),Cocoon.App.forwardAsync(b+");");Cocoon.App.forwardAsync("Cocoon.App.load('"+a+"');")};a.reloadCocoonJS=function(){if(Cocoon.App.nativeAvailable)return Cocoon.App.forwardAsync("ext.IDTK_APP.makeCall('reload');");navigator.isCocoonJS||window.parent.location.reload()};window.addEventListener("load",function(){if(!Cocoon.App.nativeAvailable&&
"CocoonJS_App_ForCocoonJS_WebViewIFrame"==window.name){Cocoon.App.forwardEventsToCocoonJSEnabled=!1;var a="timeStamp button type x y pageX pageY clientX clientY offsetX offsetY".split(" "),b="dblclick touchmove mousemove touchend touchcancel mouseup touchstart mousedown release dragleft dragright swipeleft swiperight".split(" ");for(i=0;i<b.length;i++)window.addEventListener(b[i],function(b){return function(d){if(Cocoon.App.forwardEventsToCocoonJSEnabled){var f={},h,k;for(h in d)k=a.indexOf(h),0<=
k&&(f[h]=d[h]);d="Cocoon && Cocoon.App && Cocoon.App.forwardedEventFromTheWebView && Cocoon.App.forwardedEventFromTheWebView("+JSON.stringify(b)+", '"+JSON.stringify(f)+"');";Cocoon.App.forward(d)}}}(b[i]))}});a.onLoadInCocoonJSSucceed=new Cocoon.EventHandler("IDTK_APP","App","forwardpageload");a.onLoadInCocoonJSFailed=new Cocoon.EventHandler("IDTK_APP","App","forwardpagefail");return a});
Cocoon.define("Cocoon.Proxify",function(a){a.getKeyForValueInDictionary=function(a,b){var c=null,d;for(d in a)if(a[d]===b){c=d;break}return c};a.setupOriginProxyType=function(e,b,c,d){if(Cocoon.nativeAvailable){if(!e)throw"The given typeName must be valid.";if(!b&&!c&&!d)throw"There is no point on setting up a proxy for no attributes, functions nor eventHandlers.";b=b?b:[];c=c?c:[];d=d?d:[];var f=window,h="Cocoon.Proxify.setupDestinationProxyType("+JSON.stringify(e)+", "+JSON.stringify(d)+");";Cocoon.App.forward(h);
h=f[e];f[e]=function(){var a=this;this._cocoonjs_proxy_object_data={};var g="Cocoon.Proxify.newDestinationProxyObject("+JSON.stringify(e)+");";this._cocoonjs_proxy_object_data.id=Cocoon.App.forward(g);this._cocoonjs_proxy_object_data.eventHandlers={};this._cocoonjs_proxy_object_data.typeName=e;this._cocoonjs_proxy_object_data.eventListeners={};f[e]._cocoonjs_proxy_type_data.proxyObjects[this._cocoonjs_proxy_object_data.id]=this;for(g=0;g<b.length;g++)(function(b){a.__defineSetter__(b,function(d){d=
"Cocoon.Proxify.setDestinationProxyObjectAttribute("+JSON.stringify(e)+", "+a._cocoonjs_proxy_object_data.id+", "+JSON.stringify(b)+", "+JSON.stringify(d)+");";return Cocoon.App.forward(d)});a.__defineGetter__(b,function(){var d="Cocoon.Proxify.getDestinationProxyObjectAttribute("+JSON.stringify(e)+", "+a._cocoonjs_proxy_object_data.id+", "+JSON.stringify(b)+");";return Cocoon.App.forward(d)})})(b[g]);for(g=0;g<c.length;g++)(function(b){a[b]=function(){var a=Array.prototype.slice.call(arguments);
a.unshift(b);a.unshift(this._cocoonjs_proxy_object_data.id);a.unshift(e);for(var d="Cocoon.Proxify.callDestinationProxyObjectFunction(",g=0;g<a.length;g++)d+=(1!==g?JSON.stringify(a[g]):a[g])+(g<a.length-1?", ":"");return Cocoon.App.forwardAsync(d+");")}})(c[g]);for(g=0;g<d.length;g++)(function(b){a.__defineSetter__(b,function(e){a._cocoonjs_proxy_object_data.eventHandlers[b]=e});a.__defineGetter__(b,function(){return a._cocoonjs_proxy_object_data.eventHandlers[b]})})(d[g]);a.addEventListener=function(b,
e){var d=!0,g=a._cocoonjs_proxy_object_data.eventListeners[b];if(g)d=0>g.indexOf(e);else{g=[];a._cocoonjs_proxy_object_data.eventListeners[b]=g;var c="Cocoon.Proxify.addDestinationProxyObjectEventListener("+JSON.stringify(a._cocoonjs_proxy_object_data.typeName)+", "+a._cocoonjs_proxy_object_data.id+", "+JSON.stringify(b)+");";Cocoon.App.forwardAsync(c)}d&&g.push(e)};a.removeEventListener=function(b,e){var d=a._cocoonjs_proxy_object_data.eventListeners[b];if(d){var g=d.indexOf(e);0<=g&&d.splice(g,
1)}};return this};f[e]._cocoonjs_proxy_type_data={originalType:h,proxyObjects:[]};f[e]._cocoonjs_proxy_type_data.deleteProxyObject=function(b){var d=a.getKeyForValueInDictionary(this.proxyObjects,b);if(d){var c="Cocoon.Proxify.deleteDestinationProxyObject("+JSON.stringify(e)+", "+b._cocoonjs_proxy_object_data.id+");";Cocoon.App.forwardAsync(c);b._cocoonjs_proxy_object_data=null;delete this.proxyObjects[d]}};f[e]._cocoonjs_proxy_type_data.callProxyObjectEventHandler=function(a,b){var e=this.proxyObjects[a],
d=e._cocoonjs_proxy_object_data.eventHandlers[b];d&&d({target:e})};f[e]._cocoonjs_proxy_type_data.callProxyObjectEventListeners=function(a,b){for(var e=this.proxyObjects[a],d=e._cocoonjs_proxy_object_data.eventListeners[b].slice(),c=0;c<d.length;c++)d[c]({target:e})}}};a.takedownOriginProxyType=function(a){if(Cocoon.App.nativeAvailable){var b=window;b[a]&&b[a]._cocoonjs_proxy_type_data&&(b[a]=b[a]._cocoonjs_proxy_type_data.originalType)}};a.deleteOriginProxyObject=function(a){if(Cocoon.App.nativeAvailable){var b=
window;a&&a._cocoonjs_proxy_object_data&&b[a._cocoonjs_proxy_object_data.typeName]._cocoonjs_proxy_type_data.deleteProxyObject(a)}};a.callOriginProxyObjectEventHandler=function(a,b,c){Cocoon.App.nativeAvailable&&window[a]._cocoonjs_proxy_type_data.callProxyObjectEventHandler(b,c)};a.callOriginProxyObjectEventListeners=function(a,b,c){Cocoon.App.nativeAvailable&&window[a]._cocoonjs_proxy_type_data.callProxyObjectEventListeners(b,c)};a.setupDestinationProxyType=function(a,b){Cocoon.App.nativeAvailable&&
(window[a]._cocoonjs_proxy_type_data={nextId:0,proxyObjects:{},eventHandlerNames:b})};a.takedownDestinationProxyType=function(a){if(Cocoon.App.nativeAvailable){var b=window;parent[a]&&b[a]._cocoonjs_proxy_type_data&&delete b[a]._cocoonjs_proxy_type_data}};a.newDestinationProxyObject=function(a){if(Cocoon.App.nativeAvailable){var b=window,c=new b[a];c._cocoonjs_proxy_object_data={};c._cocoonjs_proxy_object_data.typeName=a;var d=b[a]._cocoonjs_proxy_type_data.nextId;b[a]._cocoonjs_proxy_type_data.proxyObjects[d]=
c;c._cocoonjs_proxy_object_data.id=d;b[a]._cocoonjs_proxy_type_data.nextId++;for(var f=0;f<b[a]._cocoonjs_proxy_type_data.eventHandlerNames.length;f++)(function(a){c[a]=function(b){b="Cocoon.App.callOriginProxyObjectEventHandler("+JSON.stringify(this._cocoonjs_proxy_object_data.typeName)+", "+this._cocoonjs_proxy_object_data.id+", "+JSON.stringify(a)+");";Cocoon.App.forwardAsync(b)}})(b[a]._cocoonjs_proxy_type_data.eventHandlerNames[f]);c._cocoonjs_proxy_object_data.eventListeners={};return d}};a.callDestinationProxyObjectFunction=
function(a,b,c){if(Cocoon.App.nativeAvailable){var d=window,f=Array.prototype.slice.call(arguments);f.splice(0,3);d=d[a]._cocoonjs_proxy_type_data.proxyObjects[b];return d[c].apply(d,f)}};a.setDestinationProxyObjectAttribute=function(a,b,c,d){Cocoon.App.nativeAvailable&&(window[a]._cocoonjs_proxy_type_data.proxyObjects[b][c]=d)};a.getDestinationProxyObjectAttribute=function(a,b,c){if(Cocoon.App.nativeAvailable)return window[a]._cocoonjs_proxy_type_data.proxyObjects[b][c]};a.deleteDestinationProxyObject=
function(a,b){Cocoon.App.nativeAvailable&&delete window[a]._cocoonjs_proxy_type_data.proxyObjects[b]};a.addDestinationProxyObjectEventListener=function(a,b,c){Cocoon.App.nativeAvailable&&(a=window[a]._cocoonjs_proxy_type_data.proxyObjects[b],b=function(a){a="Cocoon.Proxify.callOriginProxyObjectEventListeners("+JSON.stringify(this._cocoonjs_proxy_object_data.typeName)+", "+this._cocoonjs_proxy_object_data.id+", "+JSON.stringify(c)+");";Cocoon.App.forwardAsync(a)},a._cocoonjs_proxy_object_data.eventListeners[c]=
b,a.addEventListener(c,b))};a.xhr=function(){Cocoon.Proxify.setupOriginProxyType("XMLHttpRequest","timeout withCredentials upload status statusText responseType response responseText responseXML readyState".split(" "),"open setRequestHeader send abort getResponseHeader getAllResponseHeaders overrideMimeType".split(" "),"onloadstart onprogress onabort onerror onload ontimeout onloadend onreadystatechange".split(" "))};a.audio=function(){Cocoon.Proxify.setupOriginProxyType("Audio",["src","loop","volume",
"preload"],["play","pause","load","canPlayType"],["onended","oncanplay","oncanplaythrough","onerror"])};a.console=function(){if(Cocoon.nativeAvailable){"undefined"===typeof Cocoon.originalConsole&&(Cocoon.originalConsole=window.console);for(var a=["log","error","info","debug","warn"],b={},c=0;c<a.length;c++)b[a[c]]=function(a){return function(a){try{var b="Proxified log: "+JSON.stringify(a);Cocoon.originalConsole.log(b);ext.IDTK_APP.makeCallAsync("forward",b)}catch(d){console.log("Proxified log: "+
d)}}}(a[c]);b.assert||(b.assert=function(){0<arguments.length&&!arguments[0]&&b.error("Assertion failed: "+(1<arguments.length?arguments[1]:""))});window.console=b}};a.deproxifyConsole=function(){!window.navigator.isCocoonJS&&Cocoon.nativeAvailable&&"undefined"!==typeof Cocoon.originalConsole&&(window.console=Cocoon.originalConsole,Cocoon.originalConsole=void 0)};return a});
Cocoon.define("Cocoon.Device",function(a){a.DeviceInfo={os:null,version:null,dpi:null,brand:null,model:null,imei:null,platformId:null,odin:null,openudid:null};a.getDeviceId=function(){if(Cocoon.nativeAvailable)return window.ext.IDTK_APP.makeCall("getDeviceId")};a.getDeviceInfo=function(){if(Cocoon.nativeAvailable)return window.ext.IDTK_APP.makeCall("getDeviceInfo")};a.getOrientation=function(){return Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("getPreferredOrientation"):0};a.setOrientation=
function(a){Cocoon.nativeAvailable&&window.ext.IDTK_APP.makeCall("setPreferredOrientation",a)};a.Orientations={PORTRAIT:1,PORTRAIT_UPSIDE_DOWN:2,LANDSCAPE_LEFT:4,LANDSCAPE_RIGHT:8,LANDSCAPE:12,BOTH:15};a.autoLock=function(a){if(Cocoon.nativeAvailable)return Cocoon.callNative("IDTK_APP","setAutoLockEnabled",arguments)};return a});
Cocoon.define("Cocoon.Motion",function(a){a.nativeAvailable=Cocoon.nativeAvailable;a.setAccelerometerInterval=function(a){if(Cocoon.Motion.nativeAvailable)return window.ext.IDTK_APP.makeCall("setAccelerometerUpdateIntervalInSeconds",a)};a.getAccelerometerInterval=function(){if(Cocoon.Motion.nativeAvailable)return window.ext.IDTK_APP.makeCall("getAccelerometerUpdateIntervalInSeconds")};a.setGyroscopeInterval=function(a){if(Cocoon.Motion.nativeAvailable)return window.ext.IDTK_APP.makeCall("setGyroscopeUpdateIntervalInSeconds",
a)};a.getGyroscopeInterval=function(){Cocoon.Motion.nativeAvailable&&window.ext.IDTK_APP.makeCall("getGyroscopeUpdateIntervalInSeconds")};return a});
Cocoon.define("Cocoon.Touch",function(a){a.addADivToDisableInput=function(){var a=document.createElement("div");a.id="CocoonJSInputBlockingDiv";a.style.left=0;a.style.top=0;a.style.width="100%";a.style.height="100%";a.style.position="absolute";a.style.backgroundColor="transparent";a.style.border="0px solid #000";a.style.zIndex=999999999;document.body.appendChild(a)};a.removeTheDivToEnableInput=function(){var a=document.getElementById("CocoonJSInputBlockingDiv");a&&document.body.removeChild(a)};a.disable=
function(){Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("disableTouchLayer","CocoonJSView"):navigator.isCocoonJS||Cocoon.App.EmulatedWebViewIFrame||(Cocoon.App.forwardEventsToCocoonJSEnabled=!1,Cocoon.App.forwardAsync("Cocoon && Cocoon.Touch && Cocoon.Touch.disable();"))};a.enable=function(){Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("enableTouchLayer","CocoonJSView"):navigator.isCocoonJS||Cocoon.App.EmulatedWebViewIFrame||(Cocoon.App.forwardEventsToCocoonJSEnabled=!0,Cocoon.App.forwardAsync("Cocoon && Cocoon.Touch && Cocoon.Touch.enable();"))};
a.disableInWebView=function(){Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("disableTouchLayer","WebView"):navigator.isCocoonJS||(Cocoon.App.EmulatedWebViewIFrame?Cocoon.App.forwardAsync("Cocoon && Cocoon.Touch && Cocoon.Touch.disableInWebView();"):Cocoon.Touch.addADivToDisableInput())};a.enableInWebView=function(){Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("enableTouchLayer","WebView"):navigator.isCocoonJS||(Cocoon.App.EmulatedWebViewIFrame?Cocoon.Touch.forwardAsync("Cocoon && Cocoon.Touch && Cocoon.Touch.enableInWebView();"):
Cocoon.Touch.removeTheDivToEnableInput())};return a});
Cocoon.define("Cocoon.Widget",function(a){a.WebDialog=function(){if(Cocoon.App.nativeAvailable)this.webDialogID=window.ext.IDTK_APP.makeCall("createWebDialog");else{var a=document.createElement("iframe");a.id="CocoonJSWebDialogIFrame";a.name="CocoonJSWebDialogIFrame";a.style.cssText="position:fixed;left:0;top:0;bottom:0;right:0; width:100%; height:100%;margin:0;padding:0;";var b=this;a.onload=function(){b.iframeloaded=!0;b.evalIframe("Cocoon = {}; Cocoon.Widget = {}; Cocoon.Widget.WebDialog = {} Cocoon.Widget.WebDialog.close = function(){   window.parent.CocoonJSCloseWebDialog();};");for(var a=
0;a<b.pendingEvals.length;++a)b.evalIframe(b.pendingEvals[a]);b.pendingEvals=[]};a.onerror=function(){b.close()};this.iframe=a;this.pendingEvals=[];window.CocoonJSCloseWebDialog=function(){b.close()}}};a.WebDialog.prototype={show:function(a,b){this.closeCallback=function(){Cocoon.Touch.enable();b&&b()};if(Cocoon.App.nativeAvailable)return Cocoon.Touch.disable(),window.ext.IDTK_APP.makeCallAsync("showWebDialog",this.webDialogID,a,this.closeCallback);this.iframe.src=a;document.body.appendChild(this.iframe)},
close:function(){if(Cocoon.App.nativeAvailable)return window.ext.IDTK_APP.makeCallAsync("closeWebDialog",this.webDialogID);this.iframe.parentNode&&this.iframe.parentNode.removeChild(this.iframe);this.closeCallback&&this.closeCallback()},evalIframe:function(a){window.frames.CocoonJSWebDialogIFrame.eval(a)},eval:function(a){if(Cocoon.App.nativeAvailable)return window.ext.IDTK_APP.makeCallAsync("evalWebDialog",this.webDialogID,a);this.iframeloaded?this.evalIframe(a):this.pendingEvals.push(a)}};return a});
Cocoon.define("Cocoon.Camera",function(a){navigator.getUserMedia_=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;a.CameraType={FRONT:"FRONT",BACK:"BACK"};a.CaptureFormatType={JPEG:"JPEG",RGB_565:"RGB_565",NV21:"NV21",NV16:"NV16",YUY2:"YUY2",YV12:"YV12",BGRA32:"32BGRA"};a.CameraInfo={cameraIndex:0,cameraType:a.CameraType.BACK,supportedVideoSizes:[],supportedVideoFrameRates:[],supportedVideoCaptureImageFormats:[]};a.getNumberOfCameras=function(){return Cocoon.nativeAvailable&&
navigator.isCocoonJS?Cocoon.callNative("IDTK_SRV_CAMERA","getNumberOfCameras",arguments):navigator.getUserMedia_?1:0};a.getAllCamerasInfo=function(){if(Cocoon.nativeAvailable&&navigator.isCocoonJS)return Cocoon.callNative("IDTK_SRV_CAMERA","getAllCamerasInfo",arguments)};a.getCameraInfoByIndex=function(a){if(Cocoon.nativeAvailable&&navigator.isCocoonJS)return Cocoon.callNative("IDTK_SRV_CAMERA","getCameraInfoByIndex",arguments)};a.getCameraInfoByType=function(a){if(Cocoon.nativeAvailable&&navigator.isCocoonJS)return Cocoon.callNative("IDTK_SRV_CAMERA",
"getCameraInfoByType",arguments)};a.start=function(a){if(!Boolean(a.success)||!Boolean(a.error))throw Error("Missing callbacks for Cocoon.Camera.start();");if(Cocoon.nativeAvailable){var b=Cocoon.clone({cameraIndex:0,width:50,height:50,frameRate:25},a),b=Cocoon.callNative("IDTK_SRV_CAMERA","startCapturing",b);Boolean(b)?a.success(b):a.error(!1)}else navigator.getUserMedia_({video:!0,audio:!1},function(b){a.success(b)},function(b){a.error(b)})};a.stop=function(a){if(Cocoon.nativeAvailable&&navigator.isCocoonJS)return Cocoon.callNative("IDTK_SRV_CAMERA",
"stopCapturing",arguments)};a.isCapturing=function(a){if(Cocoon.nativeAvailable&&navigator.isCocoonJS)return Cocoon.callNative("IDTK_SRV_CAMERA","isCapturing",arguments)};return a});
Cocoon.define("Cocoon.Ad",function(a){a.nativeAvailable=!!Cocoon.nativeAvailable&&!!window.ext.IDTK_SRV_AD;a.BannerLayout={TOP_CENTER:"TOP_CENTER",BOTTOM_CENTER:"BOTTOM_CENTER"};a.Rectangle=function(a,e,d,f){this.x=a;this.y=e;this.width=d;this.height=f};a.Banner=function(a){if("number"!==typeof a)throw"The given ad ID is not a number.";this.id=a;var e=this;this.onBannerShown=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannershow",function(a,b){e.id===b[0]&&a()});this.onBannerHidden=new Cocoon.EventHandler("IDTK_SRV_AD",
"Ad","onbannerhide",function(a,b){e.id===b[0]&&a()});this.onBannerReady=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannerready",function(a,b){e.id===b[0]&&a(b[1],b[2])});a=new Cocoon.Signal.createSignal;a.register("ready",this.onBannerReady);a.register("shown",this.onBannerShown);a.register("hidden",this.onBannerHidden);this.on=a.expose()};a.Banner.prototype={showBanner:function(){Cocoon.Ad.nativeAvailable&&Cocoon.callNative("IDTK_SRV_AD","showBanner",[this.id],!0)},hideBanner:function(){Cocoon.Ad.nativeAvailable&&
Cocoon.callNative("IDTK_SRV_AD","hideBanner",[this.id],!0)},load:function(){Cocoon.Ad.nativeAvailable&&Cocoon.callNative("IDTK_SRV_AD","refreshBanner",[this.id],!0)},getRectangle:function(){if(Cocoon.Ad.nativeAvailable)return Cocoon.callNative("IDTK_SRV_AD","getRectangle",[this.id])},setRectangle:function(a){if(Cocoon.Ad.nativeAvailable)return Cocoon.callNative("IDTK_SRV_AD","setRectangle",[this.id,a])},setBannerLayout:function(a){if(Cocoon.Ad.nativeAvailable)return Cocoon.callNative("IDTK_SRV_AD",
"setBannerLayout",[this.id,a])}};a.Interstitial=function(a){if("number"!==typeof a)throw"The given ad ID is not a number.";this.id=a;var e=this;this.onFullScreenShown=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenshow",function(a,b){e.id===b[0]&&a()});this.onFullScreenHidden=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenhide",function(a,b){e.id===b[0]&&a()});this.onFullScreenReady=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenready",function(a,b){e.id===b[0]&&a()});a=
new Cocoon.Signal.createSignal;a.register("ready",this.onFullScreenReady);a.register("shown",this.onFullScreenShown);a.register("hidden",this.onFullScreenHidden);this.on=a.expose()};a.Interstitial.prototype={showInterstitial:function(){if(Cocoon.Ad.nativeAvailable)return Cocoon.callNative("IDTK_SRV_AD","showFullScreen",[this.id],!0)},refreshInterstitial:function(){if(Cocoon.Ad.nativeAvailable)return Cocoon.callNative("IDTK_SRV_AD","refreshFullScreen",[this.id],!0)}};a.configure=function(a){"undefined"===
typeof a&&(a={});if(Cocoon.Ad.nativeAvailable)return Cocoon.callNative("IDTK_SRV_AD","requestInitialization",arguments,!0)};a.createBanner=function(b){"undefined"===typeof b&&(b={});if(Cocoon.Ad.nativeAvailable)return b=Cocoon.callNative("IDTK_SRV_AD","createBanner",[b]),new a.Banner(b)};a.releaseBanner=function(a){if("undefined"===typeof a)throw"The banner ad object to be released is undefined";Cocoon.Ad.nativeAvailable&&Cocoon.callNative("IDTK_SRV_AD","releaseBanner",[a.id])};a.createInterstitial=
function(a){"undefined"===typeof a&&(a={});if(Cocoon.Ad.nativeAvailable)return a=Cocoon.callNative("IDTK_SRV_AD","createFullscreen",[a]),new Cocoon.Ad.Interstitial(a)};a.releaseInterstitial=function(a){if(!a)throw"The fullscreen ad object to be released is undefined";Cocoon.Ad.nativeAvailable&&Cocoon.callNative("IDTK_SRV_AD","releaseFullscreen",[a.id])};a.showBanner=function(){if(Cocoon.Ad.nativeAvailable)return Cocoon.callNative("IDTK_SRV_AD","showBanner",arguments,!0)};a.hideBanner=function(){if(Cocoon.Ad.nativeAvailable)return Cocoon.callNative("IDTK_SRV_AD",
"hideBanner",arguments,!0)};a.refreshBanner=function(){if(Cocoon.Ad.nativeAvailable)return Cocoon.callNative("IDTK_SRV_AD","refreshBanner",arguments,!0)};a.showInterstitial=function(){if(Cocoon.Ad.nativeAvailable)return Cocoon.callNative("IDTK_SRV_AD","showFullScreen",arguments,!0)};a.refreshInterstitial=function(){if(Cocoon.Ad.nativeAvailable)return Cocoon.callNative("IDTK_SRV_AD","refreshFullScreen",arguments,!0)};a.preloadedBanner=!1;a.loadBanner=function(){if(Cocoon.Ad.nativeAvailable){if(Cocoon.Ad.preloadedBanner)return Cocoon.Ad.refreshBanner();
Cocoon.Ad.preloadedBanner=!0;return Cocoon.callNative("IDTK_SRV_AD","preloadBanner",arguments,!0)}};a.preloadedInterstitial=!1;a.loadInterstitial=function(){if(Cocoon.Ad.nativeAvailable){if(Cocoon.Ad.preloadedInterstitial)return Cocoon.Ad.refreshInterstitial();Cocoon.Ad.preloadedInterstitial=!0;return Cocoon.callNative("IDTK_SRV_AD","preloadFullScreen",arguments,!0)}};a.setRectangle=function(){if(Cocoon.Ad.nativeAvailable)return Cocoon.callNative("IDTK_SRV_AD","setRectangle",arguments)};a.getRectangle=
function(){if(Cocoon.Ad.nativeAvailable)return Cocoon.callNative("IDTK_SRV_AD","getRectangle",arguments)};a.setBannerLayout=function(a){if(Cocoon.Ad.nativeAvailable)return Cocoon.callNative("IDTK_SRV_AD","setBannerLayout",arguments)};a.onBannerShown=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannershow");a.onBannerHidden=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannerhide");a.onBannerReady=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannerready");a.onFullScreenShown=new Cocoon.EventHandler("IDTK_SRV_AD",
"Ad","onfullscreenshow");a.onFullScreenHidden=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenhide");a.onFullScreenReady=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenready");var e=new Cocoon.Signal.createSignal;e.register("ready",a.onBannerReady);e.register("shown",a.onBannerShown);e.register("hidden",a.onBannerHidden);a.banner={};a.banner.on=e.expose();e=new Cocoon.Signal.createSignal;e.register("ready",a.onFullScreenReady);e.register("shown",a.onFullScreenShown);e.register("hidden",
a.onFullScreenHidden);a.interstitial={};a.interstitial.on=e.expose();return a});
Cocoon.define("Cocoon.Store",function(a){a.nativeAvailable=!!Cocoon.nativeAvailable&&!!window.ext.IDTK_SRV_STORE;a.ProductInfo={productId:"productId",productAlias:"productAlias",productType:"productType",title:"title",description:"description",price:"price",localizedPrice:"localizedPrice",downloadURL:"downloadURL"};a.ProductType={CONSUMABLE:0,NON_CONSUMABLE:1,AUTO_RENEWABLE_SUBSCRIPTION:2,FREE_SUBSCRIPTION:3,NON_RENEWABLE_SUBSCRIPTION:4};a.StoreType={APP_STORE:0,PLAY_STORE:1,MOCK_STORE:2,CHROME_STORE:3,
AMAZON_STORE:4,NOOK_STORE:5};a.PurchaseInfo=function(a,e,d,f,h){this.transactionId=a;this.purchaseTime=e;this.purchaseState=d;this.productId=f;this.quantity=h;return this};a.PurchaseState={PURCHASED:0,CANCELED:1,REFUNDED:2,EXPIRED:3};a.getStoreType=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","getStoreType",arguments):!1};a.initialize=function(a){a=a||{};a=Cocoon.clone({sandbox:!1,managed:!0},a);Cocoon.Store.requestInitialization({sandbox:a[0],managed:a[1]});Cocoon.Store.start()};
a.requestInitialization=function(a){"undefined"===typeof a?a={}:(void 0!==a.managed&&(a.remote=a.managed),void 0!==a.sandbox&&(a.debug=a.sandbox));if(Cocoon.Store.nativeAvailable)return Cocoon.callNative("IDTK_SRV_STORE","requestInitialization",arguments,!0)};a.start=function(){if(Cocoon.Store.nativeAvailable)return Cocoon.callNative("IDTK_SRV_STORE","start",arguments)};a.canPurchase=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","canPurchase",arguments):!1};a.fetchProductsFromServer=
function(){if(Cocoon.Store.nativeAvailable)return Cocoon.callNative("IDTK_SRV_STORE","fetchProductsFromServer",arguments,!0)};a.loadProducts=function(a){if(Cocoon.Store.nativeAvailable)return Cocoon.callNative("IDTK_SRV_STORE","fetchProductsFromStore",arguments,!0)};a.finish=function(a){if(Cocoon.Store.nativeAvailable)return Cocoon.callNative("IDTK_SRV_STORE","finishPurchase",arguments,!0)};a.consume=function(a,e){if(Cocoon.Store.nativeAvailable)return Cocoon.callNative("IDTK_SRV_STORE","consumePurchase",
arguments,!0)};a.purchase=function(a){if(Cocoon.Store.nativeAvailable)return Cocoon.callNative("IDTK_SRV_STORE","purchaseFeature",arguments,!0)};a.puchaseProductModal=function(a){if(Cocoon.Store.nativeAvailable)return Cocoon.callNative("IDTK_SRV_STORE","purchaseFeatureModal",arguments,!0)};a.purchaseProductModalWithPreview=function(a){if(Cocoon.Store.nativeAvailable)return Cocoon.callNative("IDTK_SRV_STORE","purchaseFeatureModalWithPreview",arguments,!0)};a.isProductPurchased=function(a){if(Cocoon.Store.nativeAvailable)return Cocoon.callNative("IDTK_SRV_STORE",
"isFeaturePurchased",arguments)};a.restore=function(){if(Cocoon.Store.nativeAvailable)return Cocoon.callNative("IDTK_SRV_STORE","restorePurchases",arguments,!0)};a.restorePurchasesModal=function(){if(Cocoon.Store.nativeAvailable)return Cocoon.callNative("IDTK_SRV_STORE","restorePurchasesModal",arguments,!0)};a.getProducts=function(){if(Cocoon.Store.nativeAvailable)return Cocoon.callNative("IDTK_SRV_STORE","getProducts",arguments)};a.addProduct=function(a){if(Cocoon.Store.nativeAvailable)return Cocoon.callNative("IDTK_SRV_STORE",
"addProduct",arguments)};a.removeProduct=function(a){if(Cocoon.Store.nativeAvailable)return Cocoon.callNative("IDTK_SRV_STORE","removeProduct",arguments)};a.getPurchases=function(){if(Cocoon.Store.nativeAvailable)return Cocoon.callNative("IDTK_SRV_STORE","getPurchases",arguments)};a.addPurchase=function(a){if(Cocoon.Store.nativeAvailable)return Cocoon.callNative("IDTK_SRV_STORE","addPurchase",arguments)};a.removePurchase=function(a){if(Cocoon.Store.nativeAvailable)return Cocoon.callNative("IDTK_SRV_STORE",
"removePurchase",arguments)};a.cancelPurchase=function(a){if(Cocoon.Store.nativeAvailable)return Cocoon.callNative("IDTK_SRV_STORE","cancelPurchase",arguments)};a.refundPurchase=function(a){if(Cocoon.Store.nativeAvailable)return Cocoon.callNative("IDTK_SRV_STORE","refundPurchase",arguments)};a.expirePurchase=function(a){if(Cocoon.Store.nativeAvailable)return Cocoon.callNative("IDTK_SRV_STORE","expirePurchase",arguments)};a.onProductsFetchStarted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductsFetchStarted");
a.onProductsFetchCompleted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductsFetchCompleted");a.onProductsFetchFailed=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductsFetchFailed");a.onProductPurchaseStarted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductPurchaseStarted");a.onProductPurchaseVerificationRequestReceived=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductPurchaseVerificationRequestReceived");a.onProductPurchaseCompleted=new Cocoon.EventHandler("IDTK_SRV_STORE",
"Store","onProductPurchaseCompleted");a.onProductPurchaseFailed=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductPurchaseFailed");a.onRestorePurchasesStarted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onRestorePurchasesStarted");a.onRestorePurchasesCompleted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onRestorePurchasesCompleted");a.onRestorePurchasesFailed=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onRestorePurchasesFailed");a.onConsumePurchaseStarted=new Cocoon.EventHandler("IDTK_SRV_STORE",
"Store","onConsumePurchaseStarted");a.onConsumePurchaseCompleted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onConsumePurchaseCompleted");a.onConsumePurchaseFailed=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onConsumePurchaseFailed");var e=new Cocoon.Signal.createSignal;e.register("load",{started:a.onProductsFetchStarted,success:a.onProductsFetchCompleted,error:a.onProductsFetchFailed});e.register("purchase",{started:a.onProductPurchaseStarted,success:a.onProductPurchaseCompleted,verification:a.onProductPurchaseVerificationRequestReceived,
error:a.onProductPurchaseFailed});e.register("consume",{started:a.onConsumePurchaseStarted,success:a.onConsumePurchaseCompleted,error:a.onConsumePurchaseFailed});e.register("restore",{started:a.onRestorePurchasesStarted,success:a.onRestorePurchasesCompleted,error:a.onRestorePurchasesFailed});a.on=e.expose();return a});
Cocoon.define("Cocoon.Notification",function(a){a.nativeAvailable=!!window.ext&&!!window.ext.IDTK_SRV_NOTIFICATION;a.Local={};a.Push={};a.Local.create=function(a){a=Cocoon.clone({message:"",soundEnabled:!0,badgeNumber:0,userData:{},contentBody:"",contentTitle:"",date:(new Date).valueOf()+1E3},a);if(Cocoon.Notification.nativeAvailable)return Cocoon.callNative("IDTK_SRV_NOTIFICATION","createLocalNotification",a)};a.Push.create=function(a){var e={message:"",soundEnabled:!0,badgeNumber:0,userData:{},
channels:[],expirationTime:0,expirationTimeInterval:0},d;for(d in e)a[d]||(a[d]=e[d]);return a};a.start=function(){if(Cocoon.Notification.nativeAvailable)return Cocoon.callNative("IDTK_SRV_NOTIFICATION","start",arguments)};a.Push.register=function(){if(Cocoon.Notification.nativeAvailable)return Cocoon.callNative("IDTK_SRV_NOTIFICATION","registerForPushNotifications",arguments,!0)};a.Push.unregister=function(){if(Cocoon.Notification.nativeAvailable)return Cocoon.callNative("IDTK_SRV_NOTIFICATION",
"unregisterForPushNotifications",arguments,!0)};a.Local.cancel=function(){if(Cocoon.Notification.nativeAvailable)return Cocoon.callNative("IDTK_SRV_NOTIFICATION","cancelLocalNotification",arguments)};a.Local.cancelLast=function(){if(Cocoon.Notification.nativeAvailable)return Cocoon.callNative("IDTK_SRV_NOTIFICATION","cancelLocalNotification",arguments,!0)};a.Local.cancelAllNotifications=function(){if(Cocoon.Notification.nativeAvailable)return Cocoon.callNative("IDTK_SRV_NOTIFICATION","cancelAllLocalNotifications",
arguments)};a.Local.send=function(a){if(Cocoon.Notification.nativeAvailable)return Cocoon.callNative("IDTK_SRV_NOTIFICATION","sendLocalNotification",arguments,!0)};a.subscribe=function(a){if(Cocoon.Notification.nativeAvailable)return Cocoon.callNative("IDTK_SRV_NOTIFICATION","subscribe",arguments,!0)};a.unsubscribe=function(a){if(Cocoon.Notification.nativeAvailable)return Cocoon.callNative("IDTK_SRV_NOTIFICATION","unsubscribe",arguments,!0)};a.Push.send=function(a){if(Cocoon.Notification.nativeAvailable)return Cocoon.callNative("IDTK_SRV_NOTIFICATION",
"sendPushNotification",arguments,!0)};a.setBadgeNumber=function(a){if(Cocoon.Notification.nativeAvailable)return Cocoon.callNative("IDTK_SRV_NOTIFICATION","setBadgeNumber",arguments)};a.getBadgeNumber=function(){if(Cocoon.Notification.nativeAvailable)return Cocoon.callNative("IDTK_SRV_NOTIFICATION","getBadgeNumber",arguments)};a.Local.getLastNotificationData=function(){if(Cocoon.Notification.nativeAvailable)return Cocoon.callNative("IDTK_SRV_NOTIFICATION","getLastReceivedLocalNotificationData",arguments)};
a.Push.getLastNotificationData=function(){if(Cocoon.Notification.nativeAvailable)return Cocoon.callNative("IDTK_SRV_NOTIFICATION","getLastReceivedPushNotificationData",arguments)};a.onRegisterForPushNotificationsSucceed=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationServiceRegistered");a.onUnregisterForPushNotificationsSucceed=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationServiceUnregistered");a.onRegisterForPushNotificationsFailed=
new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationServiceFailedToRegister");a.onPushNotificationReceived=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationReceived");a.onLocalNotificationReceived=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","localNotificationReceived");a.onPushNotificationDeliverySucceed=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationSuccessfullyDelivered");a.onPushNotificationDeliveryFailed=
new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationDeliveryError");var e=new Cocoon.Signal.createSignal;e.register("notification",{received:a.onLocalNotificationReceived});a.Local.on=e.expose();e=new Cocoon.Signal.createSignal;e.register("register",{success:a.onRegisterForPushNotificationsSucceed,unregister:a.onUnregisterForPushNotificationsSucceed,error:a.onRegisterForPushNotificationsFailed});e.register("notification",{received:a.onPushNotificationReceived});e.register("deliver",
{success:a.onPushNotificationDeliverySucceed,error:a.onPushNotificationDeliveryFailed});a.Push.on=e.expose();return a});
Cocoon.define("Cocoon.Social",function(a){a.Interface=function(){this.onLoginStatusChanged=new Cocoon.EventHandler("","dummy","onLoginStatusChanged");var a=new Cocoon.Signal.createSignal;a.register("loginStatusChanged",this.onLoginStatusChanged);this.on=a.expose();return this};a.Interface.prototype={isLoggedIn:function(){return!1},login:function(a){a&&a(!1,{message:"Not implemented!"})},logout:function(a){a&&a({message:"Not implemented!"})},getLoggedInUser:function(){return null},hasPublishPermissions:function(a){a(!0)},
requestPublishPermissions:function(a){a&&a(!0,null)},requestUser:function(a,b){a(null,{message:"Not implemented!"})},requestUserImage:function(a,b,c){a("",{message:"Not implemented!"})},requestFriends:function(a,b){a([],{message:"Not implemented!"})},publishMessage:function(a,b){b({message:"Not implemented!"})},publishMessageWithDialog:function(a,b){b({message:"Not implemented!"})}};a.SocialGamingService=function(){Cocoon.Social.SocialGamingService.superclass.constructor.call(this);return this};a.SocialGamingService.prototype=
{_cachedAchievements:null,_achievementsMap:null,_leaderboardsTemplate:null,_achievementsTemplate:null,requestScore:function(a,b){a(null,{message:"Not implemented!"})},submitScore:function(a,b,c){b&&b({message:"Not implemented!"})},showLeaderboard:function(a,b){a&&a({message:"Not implemented!"})},requestAllAchievements:function(a){a([],{message:"Not implemented!"})},requestAchievements:function(a,b){a([],{message:"Not implemented!"})},submitAchievement:function(a,b){b&&b({message:"Not implemented!"})},
resetAchievements:function(a){a&&a([],{message:"Not implemented!"})},showAchievements:function(a){if(!this._achievementsTemplate)throw"Please, provide a html template for achievements with the setTemplates method";var b=new Cocoon.Widget.WebDialog,c=!1;b.show(this._achievementsTemplate,function(d){b.closed=!0;!c&&a&&a(d)});var d=this;this.requestAchievements(function(f,h){if(!b.closed)if(h)c=!0,a&&a(h);else{var k=[];if(d._cachedAchievements)for(var g=0;g<d._cachedAchievements.length;++g){var l=d._cachedAchievements[g];
k.push(l);if(f&&f.length)for(var m=0;m<f.length;++m)if(f[m].achievementID===l.achievementID){l.achieved=!0;break}}k="addAchievements("+JSON.stringify(k)+");";b.eval(k)}})},setAchievementsMap:function(a){this._achievementsMap=a;this._cachedAchievements&&this.syncAchievementsMap(this._cachedAchievements)},setTemplates:function(a,b){this._leaderboardsTemplate=a;this._achievementsTemplate=b},setCachedAchievements:function(a){(this._cachedAchievements=a)&&this._achievementsMap&&this.syncAchievementsMap(this._cachedAchievements)},
findAchievement:function(a){if(!this._cachedAchievements)return null;for(var b=0;b<this._cachedAchievements.length;++b)if(a===this._cachedAchievements[b].achievementID)return this._cachedAchievements[b];return null},translateAchievementID:function(a){if(this._achievementsMap)for(var b in this._achievementsMap)if(b==a)return this._achievementsMap[b];return a},syncAchievementsMap:function(a){if(this._achievementsMap)for(var b=0;b<a.length;++b)for(var c in this._achievementsMap)this._achievementsMap[c]===
a[b].achievementID&&(a[b].customID=c)}};Cocoon.extend(a.SocialGamingService,a.Interface);a.ImageSize={THUMB:"thumb",SMALL:"small",MEDIUM:"medium",LARGE:"large"};a.User=function(a,b,c){this.userID=a;this.userName=b;this.userImage=c;return this};a.Message=function(a,b,c,d,f){this.message=a;this.mediaURL=b;this.linkURL=c;this.linkText=d;this.linkCaption=f;return this};a.Score=function(a,b,c,d,f){this.userID=a;this.score=b||0;this.userName=c;this.imageURL=d;this.leaderboardID=f;return this};a.ScoreParams=
function(a,b,c,d){this.userID=a;this.leaderboardID=b;this.friends=!!c;this.timeScope=d||2};a.TimeScope={ALL_TIME:0,WEEK:1,TODAY:2};a.Achievement=function(a,b,c,d,f){this.customID=this.achievementID=a;this.title=b;this.description=c;this.imageURL=d;this.points=f||0;return this};a.share=function(a){if(Cocoon.nativeAvailable)return Cocoon.callNative("IDTK_APP","share",arguments,!0)};return a});
Cocoon.define("Cocoon.Social",function(a){a.ManagerService=function(){this.services=[]};a.ManagerService.prototype={services:null,registerSocialService:function(a){this.services.push(a)},submitAchievement:function(a){for(var b=0;b<this.services.length;++b){var c=this.services[b];!c.readOnlyHint&&c.isLoggedIn()&&c.submitAchievement(a,function(a){a&&console.error("Error submitting achievement: "+a.message)})}},submitScore:function(a,b){for(var c=0;c<this.services.length;++c){var d=this.services[c];
!d.readOnlyHint&&d.isLoggedIn()&&d.submitScore(a,function(a){a&&console.error("Error submitting score: "+a.message)},b)}},getLoggedInServices:function(){for(var a=[],b=0;b<this.services.length;++b){var c=this.services[b];!c.fakeSocialService&&c.isLoggedIn()&&a.push(c)}return a},isLoggedInAnySocialService:function(){return 0<this.getLoggedInServices().length}};a.Manager=new a.ManagerService;return a});
Cocoon.define("Cocoon.Social",function(a){a.LocalStorageService=function(){Cocoon.Social.LocalStorageService.superclass.constructor.call(this);this.fakeSocialService=!0};a.LocalStorageService.prototype={loggedIn:!1,keys:{score:"Cocoon.Social.LocalStorageService.score",earnedAchievements:"Cocoon.Social.LocalStorageService.earned"},isLoggedIn:function(){return this.loggedIn},login:function(a){this.loggedIn||this.onLoginStatusChanged.notifyEventListeners(!0);this.loggedIn=!0;a&&setTimeout(function(){a(!0)},
0)},logout:function(a){this.loggedIn&&this.onLoginStatusChanged.notifyEventListeners(!0);this.loggedIn=!1;a&&setTimeout(function(){a()},0)},getLoggedInUser:function(){return new Cocoon.Social.User("me","LocalStorage")},requestUser:function(a,b){var c=new Cocoon.Social.User(b||"me","LocalStorage");a&&setTimeout(function(){a(c)},0)},requestScore:function(a,b){var c=localStorage.getItem(this.keys.score),d=parseInt(c)||0;setTimeout(function(){a(new Cocoon.Social.Score("me",d))},0)},submitScore:function(a,
b,c){c=localStorage.getItem(this.keys.score);c=parseInt(c)||0;a>c&&localStorage.setItem(this.keys.score,a);b&&setTimeout(function(){b()},0)},getLocalStorageEarnedAchievements:function(){var a=localStorage.getItem(this.keys.earnedAchievements),b=[];a&&(a=JSON.stringify(a))&&a.length&&(b=a);return b},requestAchievements:function(a,b){var c=this.getLocalStorageEarnedAchievements();setTimeout(function(){a(c)},0)},submitAchievement:function(a,b){if(null===a||"undefined"===typeof a)throw"No achievementID specified";
for(var c=this.getLocalStorageEarnedAchievements(),d=!1,f=0;f<c.length;++f)if(c[f]===a){d=!0;break}d||(c.push(a),localStorage.setItem(this.keys.earnedAchievements,JSON.stringify(c)));b&&setTimeout(function(){b()},0)},resetAchievements:function(a){localStorage.removeItem(this.keys.earnedAchievements);a&&setTimeout(function(){a()},0)}};Cocoon.extend(a.LocalStorageService,a.SocialGamingService);a.LocalStorage=new a.LocalStorageService;return a});
Cocoon.define("Cocoon.Social",function(a){function e(a,b){return{access_token:a.access_token,state:a.state,error:b,expires_in:a.expirationDate?a.expirationDate-Date.now():0,player_id:a.playerId}}function b(a){var b=a.image?a.image.url:"",b=b.replace(/sz=\d+/g,"sz=100");return new Cocoon.Social.User(a.id,a.displayName,b)}function c(a){var b=new Cocoon.Social.Achievement(a.id,a.name,a.description,a.revealedIconUrl,0);b.gpAchievementData=a;return b}a.GooglePlayGamesExtension=function(){this.nativeExtensionName=
"IDTK_SRV_GOOGLE_PLAY_GAMES";this.extensionName="Social.GooglePlayGames";this.nativeAvailable=Cocoon.nativeAvailable&&"undefined"!==typeof window.ext[this.nativeExtensionName];this.auth=new Cocoon.Social.GooglePlayGamesAuthExtension(this);this.client=new Cocoon.Social.GooglePlayGamesClientExtension(this);this.defaultScopes=["https://www.googleapis.com/auth/games","https://www.googleapis.com/auth/plus.login"];this.gamesAPI="/games/v1";this.plusAPI="/plus/v1";this.onSessionChanged=new Cocoon.EventHandler(this.nativeExtensionName,
this.extensionName,"onSessionChanged");Cocoon.Social.GooglePlayGames=this;var a=this;this.onSessionChanged.addEventListener(function(b,c){a.token=e(b,c);b&&b.access_token&&a.client.request({path:a.gamesAPI+"/players/me",callback:function(b){a.currentPlayer=b}})});return this};a.GooglePlayGamesExtension.prototype={token:null,settings:{},socialService:null,currentPlayer:null,initialized:!1,auth:null,client:null,init:function(a){if(!a||"object"!==typeof a)throw"Invalid params argument";this.settings=
a;this.initialized=!0;if(this.nativeAvailable)Cocoon.callNative(this.nativeExtensionName,"init",[this.settings.clientId],!0);else{var b=this,c=function(){gapi.auth.authorize({immediate:!0,scope:b.defaultScopes,client_id:b.settings.clientId},function(a){(b.token=a)&&a.access_token&&b.onSessionChanged.notifyEventListeners(a)})};window.gapi?c():(window.onGapiLoadCallback=function(){window.setTimeout(c,1)},a=document.createElement("script"),a.src="https://apis.google.com/js/client.js?onload=onGapiLoadCallback",
document.getElementsByTagName("head")[0].appendChild(a))}},getSocialInterface:function(){if(!this.initialized)throw"You must call init() before getting the Social Interface";this.socialService||(this.socialService=new Cocoon.Social.SocialGamingServiceGooglePlayGames(this));return this.socialService},getMultiplayerInterface:function(){return Cocoon.Multiplayer.GooglePlayGames},share:function(){window.open(this.href,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600");return!1}};
a.GooglePlayGamesAuthExtension=function(a){this.extension=a;return this};a.GooglePlayGamesAuthExtension.prototype={authorize:function(a,b){var c=this;this.extension.nativeAvailable?Cocoon.callNative(this.extension.nativeExtensionName,"authorize",[a,function(a,d){c.extension.token=e(a,d);b&&b(c.extension.token)}],!0):gapi.auth.authorize(a,function(a){c.extension.token=a;c.extension.onSessionChanged.notifyEventListeners(a,a?a.error:null);b&&b(a)})},disconnect:function(a){this.extension.nativeAvailable?
Cocoon.callNative(this.extension.nativeExtensionName,"disconnect",[a],!0):a&&a({error:"Not implemented yet"})},init:function(a){this.extension.nativeAvailable?a():gapi.auth.init(a)},getToken:function(){return this.extension.nativeAvailable?this.extension.token:gapi.auth.getToken()},setToken:function(a){this.extension.nativeAvailable?this.extension.token=a:gapi.auth.setToken(a)}};a.GooglePlayGamesClientExtension=function(a){this.extension=a;return this};a.GooglePlayGamesClientExtension.prototype={setApiKey:function(a){this.extension.nativeAvailable?
Cocoon.callNative(this.extension.nativeExtensionName,"setApiKey",[a],!0):gapi.client.setApiKey(a)},request:function(a){if(this.extension.nativeAvailable){if(a.callback)return Cocoon.callNative(this.extension.nativeExtensionName,"request",[a,function(b,c){var g=b;c&&(g=b||{},g.error=c);a.callback(g)}],!0),null;var b=this;return{execute:function(c){Cocoon.callNative(b.extension.nativeExtensionName,"request",[a,function(a,b){var d=a;b&&(d=a||{},d.error=b);c(d)}],!0)}}}return gapi.client.request(a)}};
a.GooglePlayGames=new Cocoon.Social.GooglePlayGamesExtension;a.SocialGamingServiceGooglePlayGames=function(a){Cocoon.Social.SocialGamingServiceGooglePlayGames.superclass.constructor.call(this);this.gapi=a;var b=this;this.gapi.onSessionChanged.addEventListener(function(a){a=a||{};b.onLoginStatusChanged.notifyEventListeners(!!a.access_token,a.error)});return this};a.SocialGamingServiceGooglePlayGames.prototype={isLoggedIn:function(){return this.gapi.token&&this.gapi.token.access_token?!0:!1},login:function(a){var b=
this;this.gapi.auth.authorize({client_id:this.gapi.settings.clientId,scope:this.gapi.defaultScopes},function(c){a&&a(b.isLoggedIn(),c.error)})},logout:function(a){this.gapi.auth.disconnect(a)},getLoggedInUser:function(){return this.gapi.currentPlayer?fromGPUserToCocoonUser(this.gapi.currentPlayer):null},requestUser:function(a,b){this.gapi.client.request({path:this.gapi.gamesAPI+"/players/"+(b||"me"),callback:function(b){var c=b&&!b.error?new Cocoon.Social.User(b.playerId,b.displayName,b.avatarImageUrl):
null;a(c,b.error)}})},requestUserImage:function(a,b,c){this.requestUser(function(b,g){if(b&&b.userImage){var f;f=c||Cocoon.Social.ImageSize.MEDIUM;f=f===Cocoon.Social.ImageSize.THUMB?100:f===Cocoon.Social.ImageSize.MEDIUM?200:f===Cocoon.Social.ImageSize.LARGE?512:void 0;-1===b.userImage.indexOf("sz=")?b.userImage+="?sz="+f:b.userImage=b.userImage.replace(/sz=\d+/g,"sz="+f)}a(b?b.userImage:null,g)},b)},requestFriends:function(a,c){this.gapi.client.request({path:this.gapi.plusAPI+"/people/"+(c||"me")+
"/people/visible",params:{orderBy:"best"},callback:function(c){if(c&&!c.error){for(var f=[],g=0;g<c.items.length;++g)f.push(b(c.items[g]));a(f)}else a([],c?c.error:null)}})},publishMessage:function(a,b){b&&b("Not supported... use publishMessageWithDialog method instead")},publishMessageWithDialog:function(a,b){if(this.gapi.nativeAvailable)Cocoon.callNative(this.gapi.nativeExtensionName,"shareMessage",[{prefilledText:a.message,mediaUrl:a.mediaURL,mediaTitle:a.linkCaption,mediaDescription:a.linkText,
url:a.linkURL},b],!0);else{var c=this,e=function(){gapi.interactivepost.render("sharePost",{contenturl:"https://plus.google.com/pages/",contentdeeplinkid:"/pages",clientid:c.gapi.settings.clientId,cookiepolicy:"single_host_origin",prefilltext:a.message,calltoactionlabel:"CREATE",calltoactionurl:"http://plus.google.com/pages/create",calltoactiondeeplinkid:"/pages/create"})};if(gapi.interactivepost)e();else{var g=document.createElement("script");g.type="text/javascript";g.async=!0;g.src="https://apis.google.com/js/plusone.js";
g.onload=function(){e()};document.getElementsByTagName("head")[0].appendChild(g)}}},requestScore:function(a,b){b=b||{};var c=b.userID||"me",e=b.leaderboardID||this.gapi.settings.defaultLeaderboard;if(!e)throw"leaderboardID not provided in the params. You can also set the default leaderboard in the init method";this.gapi.client.request({path:this.gapi.gamesAPI+"/players/"+c+"/leaderboards/"+e+"/scores/ALL_TIME",callback:function(b){b&&b.error?a(null,b.error):b&&b.items&&0<b.items.length?(b=b.items[0],
b=new Cocoon.Social.Score(c,b.scoreValue,"","",b.leaderboard_id),a(b,null)):a(null,null)}})},submitScore:function(a,b,c){c=c||{};c=c.leaderboardID||this.gapi.settings.defaultLeaderboard;if(!c)throw"leaderboardID not provided in the params. You can also set the default leaderboard in the init method";this.gapi.client.request({path:this.gapi.gamesAPI+"/leaderboards/"+c+"/scores",method:"POST",params:{score:a},callback:function(a){b&&b(a?a.error:null)}})},showLeaderboard:function(a,b){b=b||{};var c=
b.leaderboardID||this.gapi.settings.defaultLeaderboard;if(!c)throw"leaderboardID not provided in the params. You can also set the default leaderboard in the init method";if(!/(iPad|iPhone|iPod)/ig.test(navigator.userAgent)&&this.gapi.nativeAvailable)Cocoon.callNative(this.gapi.nativeExtensionName,"showLeaderboard",[c,b.timeScope||0,a],!0);else{if(!this._leaderboardsTemplate)throw"Please, provide a html template for leaderboards with the setTemplates method";var e=new Cocoon.Widget.WebDialog,g=!1;
e.show(this._leaderboardsTemplate,function(b){e.closed=!0;!g&&a&&a(b)});var l=b.friends?"SOCIAL":"PUBLIC",m="ALL_TIME";b.timeScope===Cocoon.Social.TimeScope.WEEK?m="WEEKLY":b.timeScope===Cocoon.Social.TimeScope.TODAY&&(m="DAILY");this.gapi.client.request({path:this.gapi.gamesAPI+"/leaderboards/"+c+"/window/"+l,method:"GET",params:{timeSpan:m},callback:function(b){if(!e.closed)if(b.error)a&&(g=!0,a(b.error),e.close());else{var f=[],l=[];b&&b.items&&(l=b.items.slice(0));b&&b.playerScore&&l.push(b.playerScore);
for(b=0;b<l.length;++b){var m=l[b],n=new Cocoon.Social.Score(m.player.playerId,m.scoreValue,m.player.displayName,m.player.avatarImageUrl,c);n.imageURL+="?sz=50";n.position=m.scoreRank||b+1;n.me=!1;f.push(n)}f="addScores("+JSON.stringify(f)+")";e.eval(f)}}})}},prepareAchievements:function(a,b){if(!this._cachedAchievements||a){var e=this;this.gapi.client.request({path:this.gapi.gamesAPI+"/achievements",callback:function(a){if(a&&!a.error){var g=[];if(a&&a.items)for(var d=0;d<a.items.length;d++)g.push(c(a.items[d]));
e.setCachedAchievements(g);b(g,null)}else b([],a?a.error:null)}})}else b(this._cachedAchievements,null)},requestAllAchievements:function(a){this.prepareAchievements(!0,a)},requestAchievements:function(a,b){var c=this;this.prepareAchievements(!1,function(e,g){g?a([],g):c.gapi.client.request({path:c.gapi.gamesAPI+"/players/"+(b||"me")+"/achievements",params:{state:"UNLOCKED"},callback:function(b){if(b&&!b.error){var g=[];if(b.items)for(var e=0;e<b.items.length;e++){var f=c.findAchievement(b.items[e].id);
f&&g.push(f)}a(g,null)}else a([],b?b.error:null)}})})},submitAchievement:function(a,b){if(null===a||"undefined"===typeof a)throw"No achievementID specified";var c=this.translateAchievementID(a);this.gapi.nativeAvailable?Cocoon.callNative(this.gapi.nativeExtensionName,"unlockAchievement",[c,!!this.gapi.settings.showAchievementNotifications,b],!0):this.gapi.client.request({path:this.gapi.gamesAPI+"/achievements/"+c+"/unlock",method:"POST",callback:function(a){b&&b(a?a.error:null)}})},resetAchievements:function(a){this.gapi.client.request({path:"/games/v1management/achievements/reset",
method:"POST",callback:function(b){a&&a(b?b.error:null)}})},showAchievements:function(a){!/(iPad|iPhone|iPod)/ig.test(navigator.userAgent)&&this.gapi.nativeAvailable?Cocoon.callNative(this.gapi.nativeExtensionName,"showAchievements",[a],!0):Cocoon.Social.SocialGamingServiceGooglePlayGames.superclass.showAchievements.call(this)}};Cocoon.extend(Cocoon.Social.SocialGamingServiceGooglePlayGames,Cocoon.Social.SocialGamingService);return a});
Cocoon.define("Cocoon.Social",function(a){function e(a){return new Cocoon.Social.User(a.playerID,a.alias)}a.GameCenterExtension=function(){this.nativeExtensionName="IDTK_SRV_GAMECENTER";this.extensionName="Social.GameCenter";this.nativeAvailable=!!window.ext&&!!window.ext[this.nativeExtensionName];var a=this;this.nativeAvailable&&(this.onGameCenterLoginStateChanged=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onGameCenterLoginStateChanged"),this.onGameCenterLoginStateChanged.addEventListener(function(c,
d){a._currentPlayer=c}));return this};a.GameCenterExtension.prototype={_currentPlayer:null,getSocialInterface:function(){this._socialService||(this._socialService=new Cocoon.Social.SocialGamingServiceGameCenter(this));return this._socialService},getMultiplayerInterface:function(){return Cocoon.Multiplayer.GameCenter},isLoggedIn:function(){return this._currentPlayer&&this._currentPlayer.isAuthenticated},login:function(a){var c=this;if(this.nativeAvailable)Cocoon.callNative(this.nativeExtensionName,
"login",[function(d,e){c._currentPlayer=d;a&&a(d,e)}],!0);else throw"Game Center not available";},getLocalPlayer:function(){if(this._currentPlayer)return this._currentPlayer;if(this.nativeAvailable)return this._currentPlayer=Cocoon.callNative(this.nativeExtensionName,"getLocalPlayer",[]);throw"Game Center not available";},loadPlayers:function(a,c){if(this.nativeAvailable)Cocoon.callNative(this.nativeExtensionName,"loadPlayers",[a,c],!0);else throw"Game Center not available";},loadFriends:function(a){if(this.nativeAvailable)Cocoon.callNative(this.nativeExtensionName,
"loadFriends",[a],!0);else throw"Game Center not available";},loadAchievements:function(a){if(this.nativeAvailable)Cocoon.callNative(this.nativeExtensionName,"loadAchievements",[a],!0);else throw"Game Center not available";},loadAchievementDescriptions:function(a){if(this.nativeAvailable)Cocoon.callNative(this.nativeExtensionName,"loadAchievementDescriptions",[a],!0);else throw"Game Center not available";},loadScores:function(a,c){if(this.nativeAvailable)Cocoon.callNative(this.nativeExtensionName,
"loadScores",[c,a],!0);else throw"Game Center not available";},submitScore:function(a,c){if(this.nativeAvailable)Cocoon.callNative(this.nativeExtensionName,"submitScore",[a,c],!0);else throw"Game Center not available";},submitAchievements:function(a,c){if(this.nativeAvailable)Cocoon.callNative(this.nativeExtensionName,"submitAchievements",[a,c],!0);else throw"Game Center not available";},resetAchievements:function(a){if(this.nativeAvailable)Cocoon.callNative(this.nativeExtensionName,"resetAchievements",
[a],!0);else throw"Game Center not available";},showAchievements:function(a){if(this.nativeAvailable)Cocoon.callNative(this.nativeExtensionName,"showAchievements",[a],!0);else throw"Game Center not available";},showLeaderboards:function(a,c){if(this.nativeAvailable)Cocoon.callNative(this.nativeExtensionName,"showLeaderboards",[c,a],!0);else throw"Game Center not available";}};a.GameCenter=new a.GameCenterExtension;a.GameCenter.Player=function(){this.alias=this.playerID="";this.isFriend=!1};a.GameCenter.LocalPlayer=
function(){this.alias=this.playerID="";this.isAuthenticated=!1};a.GameCenter.Achievement=function(a,c){this.identifier=a;this.percentComplete=c;this.lastReportedDate=0};a.GameCenter.AchievementDescription=function(){this.unachievedDescription=this.achievedDescription=this.title=this.identifier="";this.maximumPoints=0};a.GameCenter.Score=function(a,c,d,e,h,k){this.userID=a;this.score=c||0;this.userName=d;this.imageURL=e;this.leaderboardID=h;this.rank=k.rank;this.originalScoreObject=k;return this};
a.GameCenter.Leaderboard=function(a,c,d,e,h,k){this.category=a;this.playerIDs=c;this.timeScope=d;this.playerScope=e;this.rangeStart=h;this.rangeLength=k;this.scores=[];this.localPlayerScore=[];this.localizedTitle=localizedTitle};a.GameCenter.TimeScope={TODAY:0,WEEK:1,ALL_TIME:2};a.GameCenter.PlayerScope={GLOBAL:0,FRIENDS:1};a.SocialGamingServiceGameCenter=function(a){Cocoon.Social.SocialGamingServiceGameCenter.superclass.constructor.call(this);this.gc=a;var c=this;this.gc.onGameCenterLoginStateChanged.addEventListener(function(a,
b){c.onLoginStatusChanged.notifyEventListeners(a.isAuthenticated,b)});return this};a.SocialGamingServiceGameCenter.prototype={_cachedAchievements:null,isLoggedIn:function(){return this.gc.isLoggedIn()},login:function(a){this.gc.login(function(c,d){a&&a(c.isAuthenticated,d)})},logout:function(a){a&&a({message:"User has to logout from the Game Center APP"})},getLoggedInUser:function(){return e(this.gc._currentPlayer?this.gc._currentPlayer:this.gc.getLocalPlayer())},requestUser:function(a,c){if(c)this.gc.loadPlayers([c],
function(c,d){var k=c&&c.length?e(c[0]):null;a(k,d)});else{var d=this;setTimeout(function(){a(d.getLoggedInUser())})}},requestFriends:function(a,c){this.gc.loadFriends(function(c,f){var h=[];if(c&&c.length)for(var k=0;k<c.length;++k)h.push(e(c[k]));a(h,f)})},requestScore:function(a,c){var d={},e=c||{};e.leaderboardID&&(d.category=e.leaderboardID);d.playerIDs=[e.userID||this.getLoggedInUser().userID];this.gc.loadScores(function(c,d){var g=null;e.userID&&c&&c.scores&&c.scores.length?g=c.scores[0]:c&&
c.localPlayerScore&&(g=c.localPlayerScore);g=g?new Cocoon.Social.GameCenter.Score(g.playerID,g.value,"","",g.category,g):null;a(g,d)},d)},submitScore:function(a,c,d){this.gc.submitScore({value:a,category:(d||{}).leaderboardID||""},function(a){c&&c(a)})},showLeaderboard:function(a,c){this.gc.showLeaderboards(function(c){a&&a(c)},{category:(c||{}).leaderboardID||""})},prepareAchievements:function(a,c){if(!this._cachedAchievements||a){var d=this;this.gc.loadAchievementDescriptions(function(a,b){if(b)c([],
b);else{var e=[];if(a&&a.length)for(var g=0;g<a.length;g++)e.push(new Cocoon.Social.GameCenter.Achievement(a[g].identifier,a[g].title,a[g].achievedDescription,"",a[g].maximumPoints));d.setCachedAchievements(e);c(e,null)}})}else c(this._cachedAchievements,null)},requestAllAchievements:function(a){this.prepareAchievements(!0,a)},requestAchievements:function(a,c){var d=this;this.prepareAchievements(!1,function(c,e){e?a([],e):d.gc.loadAchievements(function(c,g){if(g)a([],c.error);else{var e=[];if(c&&
c.length)for(var f=0;f<c.length;f++){var h=d.findAchievement(c[f].identifier);h&&e.push(h)}a(e,null)}})})},submitAchievement:function(a,c){if(null===a||"undefined"===typeof a)throw"No achievementID specified";var d=this.translateAchievementID(a);this.gc.submitAchievements([{identifier:d,percentComplete:100}],c)},resetAchievements:function(a){this.gc.resetAchievements(a)},showAchievements:function(a){this.gc.showAchievements(function(c){a&&a(c)})}};Cocoon.extend(a.SocialGamingServiceGameCenter,a.SocialGamingService);
return a});
Cocoon.define("Cocoon.Social",function(a){function e(a,b){var c=null;0===a.state&&(c={accessToken:a.accessToken,expirationDate:a.expirationDate,userID:a.user?a.userID:null,permissions:a.permissions,user:a.user});var d=a.state;return{status:0===d?"connected":1===d?"not_authorized":"unknown",authResponse:c,error:b}}function b(a){return new Cocoon.Social.User(a.id,a.username?a.username:a.first_name+" "+a.last_name)}function c(a){return{link:a.linkURL,description:a.message,name:a.linkText,caption:a.linkCaption,
picture:a.mediaURL}}function d(a,b){var c=new Cocoon.Social.Score(a.user.id,a.score,a.user.name);b&&(c.leaderboardID=b.leaderboardID);c.imageURL="https://graph.facebook.com/"+a.user.id+"/picture";return c}function f(a){var b=new Cocoon.Social.Achievement(a.id,a.title,a.description,a.image[0].url,a.data.points);b.fbAchievementData=a;return b}a.FacebookExtension=function(){this.nativeExtensionName="IDTK_SRV_FACEBOOK";this.extensionName="Social.Facebook";this.nativeAvailable=!!window.ext&&!!window.ext[this.nativeExtensionName];
this.Event=new Cocoon.Social.FacebookEvent(this.nativeAvailable);var a=this;this.nativeAvailable&&(this.onFacebookSessionStateChanged=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onFacebookSessionStateChanged"),Cocoon.Social.Facebook=this,this.onFacebookSessionStateChanged.addEventListener(function(b,c){var d=e(b,c);0==b.state&&a.Event.notify("auth.login",d);a.Event.notify("auth.authResponseChange",d);a.Event.notify("auth.statusChange",d)}));return this};a.FacebookExtension.prototype=
{_currentSession:null,_appId:null,_socialService:null,init:function(a){if(!a||!a.appId)throw"appId must be specified!";this._appId=a.appId;this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"init",[a],!0):FB.init(a);var b=this;this.Event.subscribe("auth.authResponseChange",function(a){b._currentSession=a;a.authResponse&&!a.authResponse.user&&b.api("me?fields=username",function(a){b._currentSession.authResponse.user=a})})},getSocialInterface:function(){if(!this._appId)throw"You must call init() before getting the Social Interface";
this._socialService||(this._socialService=new Cocoon.Social.SocialGamingServiceFacebook(this));return this._socialService},login:function(a,b){var c=this;this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"login",[b,function(b,d){c._currentSession=e(b,d);a&&a(c._currentSession)}],!0):FB.login(function(b){c._currentSession=b;a&&a(b)},b)},logout:function(a){this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"logout",[function(b,c){a&&a(e(b,c))}],!0):FB.logout(function(b){a&&
a(b)})},getAuthResponse:function(){if(this.nativeAvailable){var a=Cocoon.callNative(this.nativeExtensionName,"getFacebookSession",[]);return e(a)}return FB.getAuthResponse()},getLoginStatus:function(a,b){if(this.nativeAvailable){var c=this;setTimeout(function(){var b=Cocoon.callNative(c.nativeExtensionName,"getFacebookSession",[]);a&&a(e(b))},50)}else FB.getLoginStatus(a,b)},api:function(a,b,c,d){if(this.nativeAvailable){var e=arguments[0],f=3<arguments.length?arguments[1]:"GET",h=null;3==arguments.length&&
(h=arguments[1]);4==arguments.length&&(h=arguments[2]);return Cocoon.callNative(this.nativeExtensionName,"api",[e,f,h,1<arguments.length?arguments[arguments.length-1]:function(){}],!0)}FB.api(a,b,c,d)},ui:function(a,b){if(this.nativeAvailable)return a=arguments[0],Cocoon.callNative(this.nativeExtensionName,"ui",[a,1<arguments.length?arguments[1]:function(){}],!0);navigator.isCocoonJS||FB.ui(a,b)},requestAdditionalPermissions:function(a,b,c){this.nativeAvailable?(b=b.split(","),Cocoon.callNative(this.nativeExtensionName,
"requestAdditionalPermissions",[a,b,function(a,b){c&&c(e(a,b))}],!0)):FB.login(c,{scope:b})},getPermissions:function(a){this.api("me/permissions",function(b){a(b.data&&b.data[0]?b.data[0]:{})})},showShareDialog:function(a,b){this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"showShareDialog",[a,b],!0):(a.method="feed",FB.ui(a,b))},uploadPhoto:function(a,b){this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"uploadPhoto",[a,b],!0):b({error:{message:"Not implemented"}})},
showFriendPicker:function(a){this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"showFriendPicker",[a],!0):a({error:{message:"Not implemented"}})}};a.FacebookEvent=function(a){this.nativeAvailable=a;return this};a.FacebookEvent.prototype={subscribe:function(a,b){if(this.nativeAvailable){var c=a+"listeners";this[c]=this[c]||[];this[c].push(b)}else navigator.isCocoonJS||FB.Event.subscribe(a,b)},unsubscribe:function(a,b){if(this.nativeAvailable){var c=this[a+"listeners"];if(c){var d=c.indexOf(b);
-1!==d&&c.splice(d,1)}}else navigator.isCocoonJS||FB.Event.unsubscribe(a,b)},notify:function(a,b){var c=this[a+"listeners"];if(c)for(var d=0;d<c.length;++d)c[d](b)}};a.Facebook=new a.FacebookExtension;a.SocialGamingServiceFacebook=function(a){Cocoon.Social.SocialGamingServiceFacebook.superclass.constructor.call(this);this.fb=a;var b=this;this.fb.Event.subscribe("auth.authResponseChange",function(a){b.onLoginStatusChanged.notifyEventListeners("connected"==a.status,a.error)});return this};a.SocialGamingServiceFacebook.prototype=
{currentPermissions:null,isLoggedIn:function(){return this.fb._currentSession&&"connected"===this.fb._currentSession.status},login:function(a){var b=this;this.fb.login(function(c){a&&a(b.isLoggedIn(),c.error)})},logout:function(a){this.fb.logout(function(b){a&&a(b.error)})},getLoggedInUser:function(){var a=this.fb._currentSession?this.fb._currentSession.authResponse:null;return a&&a.user?b(a.user):a&&a.userID?new Cocoon.Social.Facebook.User(a.userID,"Loading..."):null},hasPublishPermissions:function(a){this.fb.getPermissions(function(b,
c){a(b.publish_actions,c)})},requestPublishPermissions:function(a){var b=this;this.fb.requestAdditionalPermissions("publish","publish_actions",function(c){c.error?a(!1,error):b.hasPublishPermissions(function(b,c){a(b,c)})})},requestUser:function(a,c){this.fb.api(c||"me",function(c){var d=c.error?null:b(c);a(d,c.error)})},requestUserImage:function(a,b,c){!b&&this.isLoggedIn()&&(b=this.fb._currentSession.authResponse.userID);var d="small";c===Cocoon.Social.ImageSize.THUMB?d="square":c===Cocoon.Social.ImageSize.MEDIUM?
d="normal":c===Cocoon.Social.ImageSize.LARGE&&(d="large");a("https://graph.facebook.com/"+b+"/picture?type="+d)},requestFriends:function(a,c){this.fb.api((c||"me")+"/friends",function(c){var d=[];if(!c.error)for(var e=0;e<c.data.length;e++)d.push(b(c.data[e]));a(d,c.error)})},preparePublishAction:function(a){if(this.currentPermissions)this.currentPermissions.publish_actions?a(!0):(this.currentPermissions=null,this.fb.requestAdditionalPermissions("publish","publish_actions",function(b){a(b.error?!1:
!0)}));else{var b=this;this.fb.getPermissions(function(c){(b.currentPermissions=c)&&b.preparePublishAction(a)})}},publishMessage:function(a,b){this.preparePublishAction(function(d){d?(d=c(a),this.fb.api("me/feed",d,function(a){b&&b(a.error)})):b&&b({message:"No publish_actions permission granted"})})},publishMessageWithDialog:function(a,b){this.fb.showShareDialog(c(a),function(a){b&&b(a.error)})},requestScore:function(a,b){this.fb.api((b&&b.userID?b.userID:"me")+"/scores",function(b){b.error?a(null,
b.error):b.data&&0<b.data.length?(b=d(b.data[0]),a(b,null)):a(null,null)})},submitScore:function(a,b,c){var d=this;this.preparePublishAction(function(e){e?d.requestScore(function(e,f){f?b&&b(f):a<=(e?e.score:0)?b&&b(null):d.fb.api("/"+(c&&c.userID?c.userID:"me")+"/scores","POST",{score:a},function(a){b&&b(a.error)})},c):b&&b({message:"No publish_actions permission granted"})})},showLeaderboard:function(a,b){if(!this._leaderboardsTemplate)throw"Please, provide a html template for leaderboards with the setTemplates method";
var c=new Cocoon.Widget.WebDialog,e=!1;c.show(this._leaderboardsTemplate,function(b){c.closed=!0;!e&&a&&a(b)});var f=this;this.fb.api(f.fb._appId+"/scores",function(b){if(!c.closed)if(b.error)a&&(e=!0,a(b.error),c.close());else{var h=[];if(b.data&&b.data.length)for(var k=0;k<b.data.length;++k){var l=d(b.data[k]);l.position=k;l.imageURL="https://graph.facebook.com/"+l.userID+"/picture";l.me=l.userID===f.fb._currentSession.authResponse.userID;h.push(l)}b="addScores("+JSON.stringify(h)+")";c.eval(b)}})},
prepareAchievements:function(a,b){if(!this._cachedAchievements||a){var c=this;this.fb.api(this.fb._appId+"/achievements",function(a){if(a.error)b([],a.error);else{var d=[];if(a.data)for(var e=0;e<a.data.length;e++)d.push(f(a.data[e]));c.setCachedAchievements(d);b(d,null)}})}else b(this._cachedAchievements,null)},requestAllAchievements:function(a){this.prepareAchievements(!0,a)},requestAchievements:function(a,b){var c=this;this.prepareAchievements(!1,function(d,e){e?a([],e):c.fb.api((b||"me")+"/achievements",
function(b){if(b.error)a([],b.error);else{var d=[];if(b.data)for(var e=0;e<b.data.length;e++){var f=c.findAchievement((b.data[e].achievement||b.data[e].data.achievement).id);f&&d.push(f)}a(d,null)}})})},submitAchievement:function(a,b){if(null===a||"undefined"===typeof a)throw"No achievementID specified";var c=this.translateAchievementID(a),d=this;this.preparePublishAction(function(a){a?d.fb.api("me/achievements","POST",{achievement:c},function(a){b&&b(a.error)}):b&&b({message:"No publish_actions permission granted"})})},
resetAchievements:function(a){var b=this;this.preparePublishAction(function(c){c?b.requestAchievements(function(c,d){if(d)a&&a(d);else for(var e=null,f=c.length,h=0;h<c.length;++h)b.fb.api("me/achievements","DELETE",{achievement:c[h].fbAchievementData.url},function(b){b.error&&(e=b.error);f--;0==f&&a&&a(e)})}):a&&a({message:"No publish_actions permission granted"})})},showAchievements:function(a){if(!this._achievementsTemplate)throw"Please, provide a html template for achievements with the setTemplates method";
var b=new Cocoon.Widget.WebDialog,c=!1;b.show(this._achievementsTemplate,function(d){b.closed=!0;!c&&a&&a(d)});var d=this;this.requestAchievements(function(e,f){if(!b.closed)if(f)c=!0,a&&a(f);else{var h=[];if(d._cachedAchievements)for(var k=0;k<d._cachedAchievements.length;++k){var p=d._cachedAchievements[k];h.push(p);if(e&&e.length)for(var q=0;q<e.length;++q)if(e[q].achievementID===p.achievementID){p.achieved=!0;break}}h="addAchievements("+JSON.stringify(h)+");";b.eval(h)}})}};Cocoon.extend(a.SocialGamingServiceFacebook,
a.SocialGamingService);if(!(navigator.isCocoonJS||"undefined"!==typeof module&&module.exports)){var h=document.getElementsByTagName("script")[0],k=document.createElement("script");k.src=(location.protocol?location.protocol:"http:")+"//connect.facebook.net/en_US/all.js";h.parentNode.insertBefore(k,h)}return a});
Cocoon.define("Cocoon.Multiplayer",function(a){a.MultiplayerService=function(a,b){this.nativeExtensionName=a;this.extensionName=b;this.nativeAvailable=!!window.ext&&!!window.ext[this.nativeExtensionName];var c=this;this.onInvitationReceived=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onInvitationReceived");this.onInvitationLoaded=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onInvitationLoaded",function(a,b){var d=b[0],e=b[1];d&&!e?(c.currentMatch=new Cocoon.Multiplayer.Match(c.nativeExtensionName,
c.extensionName,d),a(c.currentMatch,null)):a(null,e)});var d=new Cocoon.Signal.createSignal;d.register("invitation",{received:this.onInvitationReceived,loaded:this.onInvitationLoaded});this.on=d.expose();return this};a.MultiplayerService.prototype={currentMatch:null,findMatch:function(a,b){var c=this;this.nativeAvailable&&Cocoon.callNative(this.nativeExtensionName,"findMatch",[a,function(a,e){a&&!e?(c.currentMatch=new Cocoon.Multiplayer.Match(c.nativeExtensionName,c.extensionName,a),b(c.currentMatch,
null)):b(null,e)}],!0)},findAutoMatch:function(a,b){var c=this;this.nativeAvailable&&Cocoon.callNative(this.nativeExtensionName,"findAutoMatch",[a,function(a,e){a&&!e?(c.currentMatch=new Cocoon.Multiplayer.Match(c.nativeExtensionName,c.extensionName,a),b(c.currentMatch,null)):b(null,e)}],!0)},cancelAutoMatch:function(){this.nativeAvailable&&Cocoon.callNative(this.nativeExtensionName,"cancelAutoMatch",[],!0)},addPlayersToMatch:function(a,b,c){this.nativeAvailable&&Cocoon.callNative(this.nativeExtensionName,
"addPlayersToMatch",[a,b.matchID,c],!0)},getMatch:function(){return this.currentMatch}};a.Match=function(a,b,c){if("string"!==typeof a)throw"The given native extension name '"+a+"' is not a string.";if("string"!==typeof b)throw"The given extension name '"+a+"' is not a string.";this.nativeExtensionName=a;this.extensionName=b;this.nativeAvailable=Cocoon.nativeAvailable&&"undefined"!==typeof window.ext[a];this.matchID=c;var d=this;this.onMatchDataReceived=new Cocoon.EventHandler(this.nativeExtensionName,
this.extensionName,"onMatchDataReceived",function(a,b){d.matchID===b[0]&&a(d,b[1],b[2])});this.onMatchStateChanged=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onMatchStateChanged",function(a,b){d.matchID===b[0]&&a(d,b[1],b[2])});this.onMatchConnectionWithPlayerFailed=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onMatchConnectionWithPlayerFailed",function(a,b){d.matchID===b[0]&&a(d,b[1],b[2])});this.onMatchFailed=new Cocoon.EventHandler(this.nativeExtensionName,
this.extensionName,"onMatchFailed",function(a,b){d.matchID===b[0]&&a(d,b[1])});a=new Cocoon.Signal.createSignal;a.register("match",{dataReceived:this.onMatchDataReceived,stateChanged:this.onMatchStateChanged,connectionWithPlayerFailed:this.onMatchConnectionWithPlayerFailed,failed:this.onMatchFailed});this.on=a.expose()};a.Match.prototype={start:function(){this.nativeAvailable&&Cocoon.callNative(this.nativeExtensionName,"startMatch",[this.matchID],!0)},sendDataToAllPlayers:function(a,b){if(this.nativeAvailable)return Cocoon.callNative(this.nativeExtensionName,
"sendDataToAllPlayers",[this.matchID,a,b])},sendData:function(a,b,c){if(this.nativeAvailable)return Cocoon.callNative(this.nativeExtensionName,"sendData",[this.matchID,a,b,c])},disconnect:function(){if(this.nativeAvailable)return Cocoon.callNative(this.nativeExtensionName,"disconnect",[this.matchID],!0)},requestPlayersInfo:function(a){if(this.nativeAvailable)return Cocoon.callNative(this.nativeExtensionName,"requestPlayersInfo",[this.matchID,a],!0)},getExpectedPlayerCount:function(){if(this.nativeAvailable)return Cocoon.callNative(this.nativeExtensionName,
"getExpectedPlayerCount",[this.matchID])},getPlayerIDs:function(){if(this.nativeAvailable)return Cocoon.callNative(this.nativeExtensionName,"getPlayerIDs",[this.matchID])},getLocalPlayerID:function(){return this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"getLocalPlayerID",[this.matchID]):""}};a.SendDataMode={RELIABLE:0,UNRELIABLE:1};a.ConnectionState={UNKNOWN:0,CONNECTED:1,DISCONNECTED:2};a.PlayerInfo=function(a,b){this.userID=a;this.userName=b};a.MatchRequest=function(a,b,c,d,f){this.minPlayers=
a;this.maxPlayers=b;this.playersToInvite=c;this.playerGroup=d;this.playerAttributes=f;return this};return a});
Cocoon.define("Cocoon.Multiplayer",function(a){var e=[],b=0,c=[],d=0;a.LoopbackService=function(){Cocoon.Multiplayer.LoopbackService.superclass.constructor.call(this,"dummy","dummy");e.push(this);this.playerID=""+b;b++};a.LoopbackService.prototype={findMatch:function(a,b){this.findMatchCallback=b;for(var d=!1,e=0;e<c.length;++e)if(c[e]===this){d=!0;break}d||c.push(this);if(c.length>=a.minPlayers){d=[];for(e=0;e<c.length;++e)d.push(c[e].getPlayerID());for(e=0;e<c.length;++e){var m=new f(c[e]);m.playerIDs=
d.slice();c[e].currentMatch=m;c[e].findMatchCallback(m,null)}c=[]}},findAutoMatch:function(a,b){this.findMatch(a,b)},cancelAutoMatch:function(){},addPlayersToMatch:function(a,b,c){c({message:"Not implemmented"})},getPlayerID:function(){return this.playerID},getMatch:function(){return this.currentMatch}};Cocoon.extend(a.LoopbackService,a.MultiplayerService);var f=function(a){d++;f.superclass.constructor.call(this,"","",d);this.disconnected=this.started=!1;this.pendingData=[];this.service=a};f.prototype=
{start:function(){var a=this;setTimeout(function(){a.started=!0;for(var b=0;b<a.pendingData.length;++b)a.onMatchDataReceived.notifyEventListeners(a.matchID,a.pendingData[b].data,a.pendingData[b].player)},0)},sendDataToAllPlayers:function(a,b){this.sendData(a,this.playerIDs,b)},sendData:function(a,b,c){var d=this;setTimeout(function(){for(var c=0;c<e.length;++c){for(var f=null,g=0;g<b.length;++g)b[g]===e[c].getPlayerID()&&(f=e[c]);f&&f.getMatch().notifyDataReceived(a,d.service.getPlayerID())}},0)},
disconnect:function(){this.disconnected=!0;for(var a=0;a<this.playerIDs.length;++a)for(var b=this.playerIDs[a],c=0;c<e.length;++c)if(e[c].getPlayerID()===b){var d=e[a].getMatch();d.disconnected||d.onMatchStateChanged.notifyEventListeners(d,this.service.getPlayerID(),Cocoon.Multiplayer.ConnectionState.DISCONNECTED)}},requestPlayersInfo:function(a){var b=this;setTimeout(function(){for(var c=[],d=0;d<b.playerIDs.length;++d)c[d]={userID:b.playerIDs[d],userName:"Player"+b.playerIDs[d]};a(c)},1)},getExpectedPlayerCount:function(){return 0},
getPlayerIDs:function(){return this.playerIDs},getLocalPlayerID:function(){return this.service.playerID},notifyDataReceived:function(a,b){this.started?this.onMatchDataReceived.notifyEventListeners(this.matchID,a,b):this.pendingData.push({data:a,player:b})}};Cocoon.extend(f,Cocoon.Multiplayer.Match);return a});Cocoon.define("Cocoon.Multiplayer",function(a){a.GooglePlayGames=new Cocoon.Multiplayer.MultiplayerService("IDTK_SRV_MULTIPLAYER_GPG","Multiplayer.GooglePlayGames");return a});
Cocoon.define("Cocoon.Multiplayer",function(a){a.GameCenter=new Cocoon.Multiplayer.MultiplayerService("IDTK_SRV_MULTIPLAYER_GAMECENTER","Multiplayer.GameCenter");return a});
